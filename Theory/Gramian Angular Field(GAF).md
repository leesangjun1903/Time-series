# Gramian Angular Field(GAF)

Gramian Angular Field (GAF)는 시계열(Time-series) 데이터를 이미지로 변환하여 합성곱 신경망(CNN)과 같은 컴퓨터 비전 기술을 시계열 분석에 활용할 수 있게 돕는 알고리즘입니다.

## 1. 핵심 아이디어: 시간의 공간화
시계열 데이터는 1차원적인 숫자 나열입니다.  
GAF는 이 숫자들 사이의 상관관계를 2차원 평면 위의 점들 사이의 각도(Angle) 관계로 재정의합니다.  
이를 통해 시간적 의존성을 이미지의 공간적 구조로 변환합니다.

## 2. 작동 프로세스 
GAF를 생성하는 과정은 크게 세 단계로 나뉩니다. 
- 정규화 (Normalization): 시계열 데이터를 $\([-1,1]\)$ 또는 $\([0,1]\)$ 범위로 스케일링합니다.
- 극좌표계 변환 (Polar Coordinates): 정규화된 값 $(\(x_{i}\))$ 을 각도 $(\(\phi_{i}\))$ 로 변환합니다. 보통 $\(\phi =\arccos (x_{i})\)$ 를 사용합니다. 이때 시간의 흐름은 반지름 $(\(r\))$ 으로 표현됩니다.
- 삼각함수 합산 (Trigonometric Summation): 각 시점의 각도 쌍 $(\(\phi_{i},\phi_{j}\))$ 에 대해 코사인 합 법칙을 적용하여 행렬을 생성합니다.
  - GASF (Summation): $\(\cos (\phi _{i}+\phi _{j})\)$ 를 사용하며, 시계열의 상관관계를 보존합니다.
  - GADF (Difference): $\(\sin (\phi _{i}-\phi _{j})\)$ 를 사용하여 시계열의 변화량에 집중합니다.
 
### 극좌표계 변환 과정
Gramian Angular Field(GAF)의 수학적 핵심은 1차원 시계열 데이터를 극좌표계(Polar Coordinates)로 투영한 뒤, 두 시점 간의 각도 관계를 내적(Inner Product)과 유사한 방식으로 행렬화하는 것입니다.

#### 1단계: 정규화 및 극좌표계 변환 
먼저 시계열 데이터 $\(X=\{x_{1},x_{2},\dots ,x_{n}\}\)$ 의 모든 값을 $\([-1,1]\)$ 범위로 정규화합니다.  
그 후, 각 값 $\(x_{i}\)$ 를 다음 식을 통해 각도 $\(\phi _{i}\)$ 로 변환합니다.

$$\(\phi_{i}=\arccos (x_{i}),\quad 0\le \phi _{i}\le \pi \)$$

이 과정에서 시계열의 값은 각도 $(\(\phi \))$ 로, 시간의 흐름은 반지름 $(\(r\))$ 으로 대응되어 2차원 평면상의 점들로 재정의됩니다.

#### 2단계: GASF(Gramian Angular Summation Field)의 도출 
GASF는 두 각도의 합에 대한 코사인 값을 요소로 가집니다.  
삼각함수의 덧셈 정리를 적용하면 다음과 같이 전개됩니다.

$$\(GASF_{ij}=\cos (\phi_{i}+\phi_{j})=\cos \phi_{i}\cos \phi_{j}-\sin \phi_{i}\sin \phi_{j}\)$$

여기서 $\(\cos \phi_{i}=x_{i}\)$ 이고 $\(\sin \phi_{i}=\sqrt{1-x_{i}^{2}}\)$ 이므로, 원본 데이터로 치환하면 다음과 같습니다.

$$\(GASF_{ij}=x_{i}x_{j}-\sqrt{1-x_{i}^{2}}\sqrt{1-x_{j}^{2}}\)$$

이 식은 두 시점 간의 상관관계를 나타내며, 행렬의 주대각선 $(\(i=j\))$ 성분은 시계열의 각 시점별 강도를 보존합니다.

#### 상관관계의 의미 
- 상관성 반영: $\(GASF_{ij}\)$ 는 두 시점의 값 $(\(x_{i},x_{j}\))$ 이 결합된 각도의 합에 대한 코사인 값을 측정합니다.
- 시간적 의존성 보존: 단순히 두 값의 곱 $(\(x_{i}x_{j}\))$ 만 사용하는 것이 아니라, 각도로 변환된 상태에서의 상대적 위치를 고려함으로써 시계열의 시간적 상관관계(Temporal Correlation)를 2차원 행렬 형태로 보존하게 됩니다.
- 값의 범위: 결과값은 $\([-1,1]\)$ 사이에 존재하며, 이 값이 크거나 작음에 따라 두 시점 사이의 유사성이나 변화 양상을 파악할 수 있는 지표가 됩니다. 

결론적으로, 이 식은 시계열 데이터를 각도 공간으로 투영한 뒤 두 시점의 위상 합을 통해 상관관계를 인코딩하여, 1차원 시계열을 2차원 이미지 형태로 변환하기 위한 핵심 연산입니다.

시계열 데이터의 두 지점 사이의 '유사도(Similarity)'를 측정하여 이를 2차원 공간에 표현하는 기법이라고 이해하시면 가장 정확합니다.

<details>

### 측정 대상의 차이: '변화량' vs '상대적 각도' 
- 전통적 상관관계 (공분산/상관계수): 두 시점 $\(x_{i},x_{j}\)$ 의 값이 평균으로부터 얼마나 함께 멀어지는지(선형성)를 봅니다. 즉, "하나가 커질 때 다른 하나도 커지는가?"를 측정합니다.
- GASF의 상관관계: 데이터를 단위원(Circle) 상의 각도 $(\(\phi \))$ 로 변환한 후, 두 지점 사이의 위상 관계를 봅니다. 식 $\(\cos (\phi_{i}+\phi_{j})\)$ 는 두 시점이 시간의 흐름 속에서 어떤 '상태'나 '위치'에 있는지를 중첩하여 나타냅니다. 

### 기하학적 의미: 위상적 유사성 
이 공식은 두 시점이 단순한 수치적 유사성을 넘어, 전체 시계열의 흐름 안에서 유사한 시간적 패턴이나 주기성을 공유하는지 측정합니다. 
- $\(GASF_{ij}\)$ 값이 1에 가까우면: 두 시점의 위상 합이 0에 가까워, 시스템 내에서 서로 보완적이거나 강한 동기화 상태에 있음을 의미합니다.
- $\(GASF_{ij}\)$ 값이 -1에 가까우면: 위상이 반대 방향으로 작용하여 서로 상쇄되는 관계임을 나타냅니다. 

### 왜 이 방식을 사용하는가? 
일반적인 상관계수는 전체 집합의 통계적 특성을 요약하지만, GASF는 시점 대 시점 $(\(i\) vs \(j\))$ 의 모든 조합을 행렬로 펼쳐놓습니다.  
이를 통해 다음과 같은 정보를 보존합니다. 
- 시간적 의존성(Temporal Dependency): 과거 시점 $\(i\)$ 와 미래 시점 $\(j\)$ 가 어떤 각도 관계를 갖는지 2차원 이미지로 시각화하여, 딥러닝 모델(CNN 등)이 시계열의 구조적 특징을 학습하기 유리하게 만듭니다.
- 비선형적 관계: 단순 직선 관계가 아닌 삼각함수를 통한 비선형적 결합을 사용하므로, 복잡한 신호의 굴곡이나 패턴을 더 잘 잡아낼 수 있습니다. 

GASF는 "수치가 얼마나 닮았나"가 아니라 "두 시점의 각도(위상)가 결합되었을 때 어떤 패턴을 형성하는가"라는 관점에서 시계열 내의 상관관계를 측정합니다.

다만, 우리가 흔히 아는 유클리드 거리나 코사인 유사도와는 유사도를 정의하는 방식에 차이가 있습니다.

### 일반적인 유사도 vs GASF의 유사도 
- 일반적인 유사도 (예: 코사인 유사도): 두 벡터 사이의 각도 차이 $(\(\theta \))$ 를 측정하여 $\(\cos (\theta )\)$ 값이 1에 가까울수록 "두 데이터의 방향이 같다(유사하다)"고 판단합니다.
- GASF의 유사도: 데이터를 각도 $(\(\phi \))$ 로 변환한 뒤, 두 각도의 '합'인 $\(\cos (\phi_{i}+\phi_{j})\)$ 을 계산합니다. 이는 두 시점의 절대적인 위치뿐만 아니라, 시간의 흐름에 따른 위상의 변화가 어떻게 중첩되는지를 보는 것입니다.

### 왜 유사도 측정의 한 종류인가? 
GASF의 결과 행렬을 보면 왜 유사도인지 알 수 있습니다. 
- 대각선 성분 $(\(i=j\))$ : 행렬의 대각선은 자기 자신과의 관계입니다. $\(\cos (\phi_{i}+\phi_{i})=\cos (2\phi _{i})\)$ 가 되어, 해당 시점의 데이터 강도를 나타냅니다.
- 비대각 성분 $(\(i\ne j\))$ : $\(i\)$ 시점과 $\(j\)$ 시점의 값이 비슷하다면 $\(\phi_{i}\)$ 와 $\(\phi_{j}\)$ 도 비슷해집니다. 이때 계산된 값은 두 시점의 상태가 얼마나 닮아있는지, 혹은 반대인지를 $\([-1,1]\)$ 사이의 값으로 인코딩합니다. 

### 유사도를 '이미지'로 만드는 이유
GASF가 유사도를 측정하는 궁극적인 이유는 시계열의 패턴을 시각화하기 위해서입니다.  
- 반복되는 패턴: 시계열에서 비슷한 파동이 반복되면, GASF 행렬에서도 특정 간격마다 높은 유사도가 나타나 격자 무늬나 일정한 패턴이 생깁니다.  
- 급격한 변화: 데이터가 급변하면 각도가 크게 변하므로 행렬의 색상이 급격히 변하며 경계선을 형성합니다.

GASF는 "시점 $\(i\)$ 와 시점 $\(j\)$ 의 상태가 시간 축 위에서 얼마나 조화로운가(유사한가)"를 삼각함수로 계산하는 방식입니다.  
따라서 단순히 수치적으로 "값이 같다"는 수준을 넘어, "시계열의 흐름 속에서 두 시점의 위상적 위치가 유사한가"를 측정하는 고차원적인 유사도 측정법이라고 볼 수 있습니다.  
이러한 특성 덕분에 CNN(합성곱 신경망) 같은 이미지 인식 인공지능이 시계열 데이터를 분석할 때 매우 유리하게 작용합니다.

</details>

### 3단계: GADF(Gramian Angular Difference Field)의 도출 
GADF는 두 각도의 차에 대한 사인 값을 요소로 가집니다. 삼각함수의 뺄셈 정리를 적용하면 다음과 같이 전개됩니다.

$$\(GADF_{ij}=\sin (\phi_{i}-\phi_{j})=\sin \phi_{i}\cos \phi_{j}-\cos \phi_{i}\sin \phi_{j}\)$$

이를 원본 데이터 $\(x\)$ 에 대한 식으로 변환하면 다음과 같습니다.

$$\(GADF_{ij}=\sqrt{1-x_{i}^{2}}x_{j}-x_{i}\sqrt{1-x_{j}^{2}}\)$$

GADF는 두 시점 사이의 상대적인 변화량(변위)에 집중하므로, 시계열의 노이즈나 급격한 변동 패턴을 포착하는 데 유리합니다.

GADF(Gramian Angular Difference Field) 식은 두 각도의 차이에 대한 사인 삼각함수 항등식을 나타내기 때문에 상대적인 변화량(변위)을 포착하는 데 유리합니다.

#### '상대적 변화량'을 나타내는 이유 
- 위상차(Phase Difference) 측정: $\(GADF_{ij}\)$ 는 두 시점 사이의 각도 차이 $(\(\phi_{i}-\phi_{j}\))$ 를 사인 함수로 계산합니다. 이는 시간 $\(i\)$ 에서 시간 $\(j\)$ 로 이동할 때 데이터의 '상태'가 얼마나 변했는지를 직접적으로 보여주는 지표가 됩니다.
- 방향성 보존 (Skew-symmetry): 사인 함수는 기함수 $(\(\sin (-\theta )=-\sin \theta \))$ 이므로, $\(GADF_{ij}=-GADF_{ji}\)$ 가 성립합니다. 즉, 값이 증가했는지 감소했는지에 대한 방향 정보를 보존하므로 데이터의 동적인 흐름(흐름의 변화)을 민감하게 반영합니다.
- 자기 상관의 배제: 동일 시점 $(\(i=j\))$ 에서는 $\(\sin (0)=0\)$ 이 되어 행렬의 대각선 성분이 항상 0입니다. 이는 정적인 값 자체보다 시점 간의 '차이'와 '전이'에만 집중하게 만듭니다. 

#### 노이즈 및 급격한 변동에 유리한 이유 
- 미세한 변화 포착: 사인 함수는 각도 차이가 0 근처일 때(즉, 변화가 작을 때) 선형적으로 민감하게 반응합니다. 따라서 미세한 노이즈나 순간적인 튐 현상이 각도 차이로 나타날 때 이를 뚜렷한 이미지 패턴으로 인코딩합니다.
- 과도기적 특징 강조: 값이 급격히 변하는 구간에서는 $\(\phi_{i}-\phi_{j}\)$ 값이 커지며 GADF 행렬 상에 강한 시각적 대비를 만들어냅니다. 이는 CNN 모델이 시계열의 국소적인 변화(Local transitions)를 학습하는 데 매우 효과적인 단서가 됩니다. 

GADF는 두 시점의 각도 차이(위상차)를 계산함으로써 데이터가 시간의 흐름에 따라 어떻게 '이동'하고 '변화'했는지를 행렬에 기록하며, 이 과정에서 방향성과 변화폭이 강조되어 복잡한 변동 패턴을 분석하기에 적합합니다. 

### 다시 말하면,
GAF는 시계열 데이터를 $\(x_{i}=\cos \phi_{i}\)$ 로 간주하여 극좌표로 변환한 뒤, GASF는 $GASF = \tilde{X}^{T} \tilde{X} - \sqrt{I - \tilde{X}^{2}}^{T} \sqrt{I - \tilde{X}^{2}}
$ (합의 코사인), GADF는 $GADF = \(\sin (\phi_{i}-\phi_{j})\)$ (차의 사인) 공식을 통해 시계열의 시간적 의존성을 2차원 이미지 행렬로 부호화합니다.

### 왜 GAF를 사용하는가? (장점)
- 시간적 의존성 유지: 일반적인 이미지 변환과 달리, GAF는 주 대각선(Main Diagonal)을 따라 시간의 흐름을 보존하므로 CNN이 시계열의 패턴을 효과적으로 학습할 수 있습니다.
- 정보 손실 최소화: 극좌표계를 통해 1차원 데이터를 2차원으로 투영하므로 데이터 간의 관계가 풍부하게 표현됩니다.
- 컴퓨터 비전 모델 활용: ResNet이나 EfficientNet 같은 강력한 이미지 인식 모델을 시계열 분류 및 예측에 즉시 적용할 수 있습니다.

### 활용 사례
- 금융 데이터 분석: 주가 변동 패턴을 이미지로 학습하여 상승/하락 예측.
- 생체 신호 분류: ECG(심전도), EEG(뇌파) 데이터를 이미지화하여 질병 진단.
- 이상 탐지: 센서 데이터의 정상 패턴을 이미지로 학습하고, 이질적인 이미지가 생성될 때 이상 발생으로 간주.

Pyts 라이브러리 공식 문서를 참고하여 직접 코드를 실행해 보시는 것을 추천드립니다.

GAF(Gramian Angular Field)는 시계열 분석을 이미지 인식의 영역으로 끌어들인 획기적인 기법이지만, 실무 적용 시 반드시 고려해야 할 몇 가지 수학적·연산적 단점이 존재합니다.

### 연산 및 메모리 비용의 급격한 증가 (Computational Complexity) 
GAF의 가장 큰 현실적인 단점입니다. 
- 차원의 폭발: 길이가 $\(N\)$ 인 1차원 시계열 데이터를 변환하면 $\(N\times N\)$ 크기의 2차원 행렬이 생성됩니다. 예를 들어, 데이터 포인트가 1,000개인 짧은 시계열도 이미지로 바꾸면 1,000,000(100만)개의 요소를 가진 행렬이 됩니다.
- 리소스 낭비: 수만 개 이상의 긴 시계열(Long-term time series)을 처리할 경우 메모리 부족(OOM) 문제가 발생하거나, CNN 모델의 학습 속도가 현저히 느려집니다. 이를 해결하기 위해 PAA(Piecewise Aggregate Approximation) 등으로 데이터 크기를 줄여야 하는데, 이 과정에서 원본 데이터의 손실이 발생합니다.

### 정보의 중복성 (Information Redundancy) 
GAF 행렬은 수학적 특성상 불필요한 대칭성을 가집니다. 
- 대칭 구조: GASF 식인 $\(\cos (\phi_{i}+\phi_{j})\)$ 는 $\(i\)$ 와 $\(j\)$ 를 바꿔도 값이 같습니다. 즉, 주대각선을 기준으로 위아래가 똑같은 대칭 행렬이 생성됩니다.
- 효율성 저하: 이미지의 절반이 나머지 절반과 같은 정보를 담고 있기 때문에, CNN이 학습해야 할 파라미터 중 절반은 이론적으로 낭비되는 셈입니다.

### 스케일링(정규화)에 대한 민감도 
GAF는 반드시 데이터를 $\([-1,1]\)$ 또는 $\([0,1]\)$ 로 정규화해야 합니다. 
- 이상치(Outlier) 취약성: 시계열에 비정상적으로 큰 값이 하나라도 섞여 있으면, $\(\arccos \)$ 변환 과정에서 대다수의 정상 데이터가 좁은 각도 범위로 압착(Squeeze)됩니다. 이로 인해 이미지상의 패턴이 흐릿해지고 변별력이 떨어질 수 있습니다.

### 수학적 역변환의 어려움 (Irreversibility) 
GAF 이미지를 다시 1차원 시계열로 완벽하게 복구하는 것은 어렵습니다. 특히 $\(\sin \)$ 과 $\(\cos \)$의 주기성 때문에 특정 구간에서 정보의 모호함이 생길 수 있습니다.  
이는 생성 모델(GAN 등)을 이용해 시계열 데이터를 생성할 때 제약 사항이 됩니다.

### 도메인 적합성 문제
- CNN의 가정: CNN은 이미지의 '지역적 특징(Local feature)'을 추출하는 데 특화되어 있습니다. 하지만 시계열 데이터의 중요한 특징이 아주 먼 시간 간격(Long-range dependency) 사이에 존재할 경우, GAF로 변환된 이미지의 공간적 필터링이 이를 효과적으로 잡아내지 못할 수도 있습니다.

GAF는 "데이터 크기가 적당하고, CNN의 강력한 패턴 인식 기능을 활용하고 싶을 때" 유용하지만, "매우 긴 시계열 데이터"나 "실시간 처리가 극도로 중요한 환경"에서는 연산량 문제로 인해 효율성이 떨어질 수 있다는 단점이 있습니다.

## 해결 방법
GAF의 연산 비용, 대칭성으로 인한 정보 중복, 긴 시계열 처리의 한계 등을 극복하기 위해 제안된 대표적인 대체 기법들은 다음과 같습니다.

### Markov Transition Field (MTF) 
GAF가 데이터의 값(상태)에 집중한다면, MTF는 시계열의 전이(Transition) 확률에 집중합니다. 
- 특징: 시계열을 $\(Q\)$ 개의 구간(Bin)으로 나누고, 한 구간에서 다른 구간으로 이동할 확률을 행렬로 나타냅니다.
- 장점: GAF보다 비대칭적인 구조를 가지므로 정보의 중복이 적고, 특정 시간 구간 내의 동적인 변화(Dynamic)를 포착하는 데 더 유리합니다. 

### Recurrence Plot (RP) 
시계열의 재귀성(Recurrence)을 시각화하는 기법으로, 시스템의 상태가 이전과 유사한 상태로 돌아오는 패턴을 포착합니다. 
- 해결 방식: 시점 $\(i\)$ 와 $\(j\)$ 사이의 거리(Distance)가 임계값보다 작으면 1, 아니면 0으로 표시하거나 거리 자체를 이미지화합니다.
- 장점: 주기가 불규칙하거나 비선형적인 동역학 시스템의 복잡한 패턴을 GAF보다 효과적으로 분석할 수 있습니다.

### PAA(Piecewise Aggregate Approximation) 결합 
GAF의 가장 큰 문제인 연산 비용(데이터 크기 폭발)을 해결하기 위한 전처리 기법입니다. 
- 해결 방식: 긴 시계열 데이터를 바로 GAF로 바꾸지 않고, 일정 구간씩 평균을 내어 데이터 길이를 대폭 줄인 뒤 변환합니다.
- 효과: $\(N\times N\)$ 행렬의 크기를 $\(M\times M(M\ll N)\)$ 으로 줄여 메모리 효율성을 확보하면서도 핵심적인 추세 정보를 보존합니다. 

### STFT (Short-Time Fourier Transform) 기반 이미지화
수학적 투영 대신 주파수 분석을 이용하는 방식입니다.
- 해결 방식: 짧은 시간 구간마다 푸리에 변환을 수행하여 시간-주파수 영역의 스펙트로그램(Spectrogram)을 생성합니다.
- 장점: GAF가 포착하기 어려운 주기성이나 진동 특성을 훨씬 명확하게 이미지화할 수 있어, 음성이나 진동 센서 데이터 분석에 더 적합합니다. 

## 최신 동향: 다중 인코딩 결합 (2026년 기준) 
최근 연구에서는 단일 기법의 단점을 보완하기 위해 GAF, MTF, RP를 채널별로 결합(Stacking)하여 사용하는 방식이 주류를 이루고 있습니다. 
- 방법: 이미지의 R, G, B 채널에 각각 GASF, GADF, MTF를 할당하여 하나의 '컬러 시계열 이미지'를 만듭니다.
- 효과: 각 기법이 놓치는 정보(상관관계, 변화율, 전이 확률 등)를 상호 보완하여 CNN 모델의 예측 정확도를 극대화합니다. 

