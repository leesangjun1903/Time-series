# Graph-Guided Network for Irregularly Sampled Multivariate Time Series

## 1. 핵심 주장과 주요 기여

**RAINDROP**은 불규칙하게 샘플링된 다변량 시계열 데이터를 처리하기 위해 설계된 그래프 신경망입니다. 이 논문의 핵심 기여는 다음과 같습니다:[1]

- **샘플별 센서 그래프 학습**: 각 샘플에 대해 별도의 센서 그래프를 구성하고, 센서 간의 시간 변화 의존성을 명시적으로 모델링합니다.
- **메시지 전달 기반 임베딩**: 관측값(raindrops)이 센서 그래프(surface)에 비동기적으로 도착할 때 이웃 센서들로 메시지를 전파(ripples)하는 방식으로 작동합니다.
- **일반화 성능 향상**: 불규칙 샘플링, 센서 미정렬, 다양한 관측 개수 등 현실의 시계열 특성을 자연스럽게 처리하면서 기존 방법 대비 **최대 11.4% 절대 F1 점수 향상**을 달성합니다.[1]
- **센서 고장 대응**: 특정 센서가 완전히 결측된 상황(leave-sensor-out 설정)에서 기존 방법 대비 **평균 9.3% 정확도 개선**을 보입니다.

***

## 2. 해결 문제 및 제안 방법

### 문제 정의

의료, 생물학, 기후과학 등 현실의 시계열은 다음과 같은 특성을 가집니다:[1]

- **불규칙한 시간 간격**: 센서마다 관측 간의 시간 차이가 다름
- **센서 미정렬**: 다른 센서는 다른 시점에 관측됨
- **변수 개수 불일치**: 샘플마다 다른 수의 센서가 다른 시점에 기록됨
- **정보 있는 결측**: 단순 결측이 아니라 센서 고장, 의료 개입 등의 원인이 있음

기존 방법들은 이러한 특성을 충분히 처리하지 못합니다. 특히, 선행 연구들은 센서 간 상관관계가 중요하다는 것을 인식했으나, 불규칙 시계열의 센서 의존성을 동적으로 모델링하지 못했습니다.[1]

### 제안 방법: RAINDROP의 아키텍처

RAINDROP은 **3계층 계층적 구조**로 작동합니다:[1]

#### **Level 1: 관측값 임베딩 생성 (Observation Embedding)**

활성 센서 $$u$$에서 시간 $$t$$에 관측값 $$x^t_{i,u}$$가 기록되면:

$$
h^t_{i,u} = \sigma(x^t_{i,u}R_u)
$$

여기서 $$R_u$$는 센서별 변환 가중치입니다. 센서별 변환을 사용하는 이유는 각 센서의 값이 다른 분포를 따를 수 있기 때문입니다.[1]

#### **Level 2: 메시지 전달을 통한 이웃 센서 임베딩**

이웃 센서 $$v$$에 대해, 활성 센서 $$u$$로부터의 메시지 전달은:

$$
\alpha^t_{i,uv} = \sigma(h^t_{i,u}D[r_v||p^t_i]^T)
$$

$$
h^t_{i,v} = \sigma(h^t_{i,u}w_u w^T_v \alpha^t_{i,uv}e_{i,uv})
$$

여기서:[1]

- $$\alpha^t_{i,uv}$$: 시간별 주의 가중치 (센서 u가 센서 v에 얼마나 중요한지)
- $$r_v$$: 수신 센서에 특화된 가중치 벡터
- $$p^t_i$$: 삼각함수를 통해 변환된 시간 표현 (시간 정보 포함)
- $$e_{i,uv}$$: 모든 타임스탬프에서 공유되는 엣지 가중치 (센서 의존성)

#### **Level 3: 센서 그래프 구조 학습**

각 계층 $$l$$에서 엣지 가중치는 다음과 같이 업데이트됩니다:[1]

$$
e^{(l)}_{i,uv} = \frac{e^{(l-1)}_{i,uv}}{|T_{i,u}|}\sum_{t \in T_{i,u}}\alpha^{(l),t}_{i,uv}
$$

이후 하위 K% 엣지(가중치가 가장 작은)를 제거하여 그래프를 점진적으로 정제합니다. 초기 그래프는 완전 연결(fully-connected)이지만, 학습 과정에서 중요하지 않은 엣지를 자동으로 제거합니다.[1]

#### **Level 4: 센서 임베딩 생성 (Temporal Attention)**

모든 타임스탐프의 관측 임베딩을 집계할 때, 시간별 주의 가중치 $$\beta^t_{i,v}$$를 사용합니다:[1]

$$
\beta_{i,v} = \text{softmax}\left(\frac{Q_{i,v}K^T_{i,v}}{\sqrt{d_k}}s\right)
$$

$$
z_{i,v} = \sum_{t \in T_{i,v}}(\beta^t_{i,v}[h^t_{i,v}||p^t_i]W)
$$

여기서 $$s$$는 학습 가능한 집계 벡터로, 표준 self-attention 행렬의 각 행을 스칼라로 축약합니다.[1]

### 손실 함수

$$
L = L_{CE} + \lambda L_r
$$

$$
L_r = \frac{1}{M^2}\sum_{u,v \in V}\sum_{i,j \in V}\frac{||e_{i,uv} - e_{j,uv}||^2}{(N-1)^2}
$$

여기서 $$L_{CE}$$는 교차 엔트로피, $$L_r$$은 유사한 샘플이 유사한 그래프 구조를 학습하도록 권장하는 정규화 항입니다.[1]

---

## 3. 모델 구조 및 설계 원리

### 계층 구조의 설계 철학

RAINDROP의 계층 구조는 시계열 데이터의 자연스러운 계층성을 반영합니다:[1]

| 계층 | 처리 대상 | 목표 | 특징 |
|------|---------|------|------|
| 관측 | 개별 센서 값 | 값을 고차원 임베딩으로 변환 | 센서별 비선형 변환 |
| 메시지 전달 | 센서 간 관계 | 이웃 센서 정보 전파 | 그래프 기반 메시지 전달 |
| 센서 임베딩 | 시계열 집계 | 모든 관측을 고정 크기 벡터로 | 시간별 주의 메커니즘 |
| 샘플 임베딩 | 전체 샘플 | 다중 센서 정보 통합 | 결합(concatenation) 기반 |

### 시간별 주의 vs. LSTM

RAINDROP은 시간별 주의(temporal attention)를 LSTM 대신 사용합니다. 이는 다음의 이점이 있습니다:[1]

- **병렬 계산 가능**: LSTM은 순차 처리로 49% 훈련 시간 증가
- **장기 의존성 완화**: 순환 구조 없이 모든 관측을 동시에 처리
- **성능**: 시간별 주의가 LSTM 대비 **AUROC 1.8% 향상**[1]

### 센서 그래프 학습의 독특성

일반적인 그래프 신경망과 달리, RAINDROP은:[1]

- **샘플별 그래프**: 모든 샘플이 동일한 그래프가 아니라 각각의 그래프 학습
- **시간 변화 의존성**: 같은 두 센서 간에도 시점에 따라 다른 메시지 전달 강도
- **완전 연결 초기화**: 모든 센서가 처음엔 연결되지만, 학습 과정에서 50% 엣지 제거

---

## 4. 성능 향상

### 벤치마크 성능 (Setting 1: 표준 분류)

RAINDROP은 3개 데이터셋에서 최고 성능을 달성합니다:[1]

| 데이터셋 | 과제 | 성능 개선 |
|---------|------|----------|
| **P19** (38,803 환자, 34 센서) | 패혈증 예측 | AUROC 87.0% (기존 최고 86.7% 대비 +0.3%, AUPRC 51.8% vs 44.7%) |
| **P12** (11,988 환자, 36 센서) | 사망률 예측 | AUROC 72.1%, AUPRC 97.0% |
| **PAM** (5,333 샘플, 17 센서) | 일상 활동 분류 | 정확도 88.5%, F1 점수 89.8% (기존 85.9% 대비 +3.9%) |

### 센서 결측 상황에서의 성능 (Setting 2: Leave-Fixed-Sensors-Out)

센서 결측 비율이 높을수록 RAINDROP의 장점이 두드러집니다:[1]

| 결측 비율 | RAINDROP 정확도 | 기존 최고 방법 | 개선도 |
|---------|-----------------|----------------|-------|
| 10% | 77.2% | 72.6% (GRU-D) | +4.6% |
| 30% | 52.4% | 45.1% (GRU-D) | +7.3% |
| 50% | 46.6% | 37.3% (GRU-D) | **+9.3%** |

특히 50% 센서 결측 시, **정밀도 44.5% vs 29.6%, 재현율 42.4% vs 32.8%, F1 38.0% vs 26.6%**로 매우 큰 격차를 보입니다.[1]

### 무작위 센서 결측 (Setting 3: Leave-Random-Sensors-Out)

매 샘플마다 다른 센서가 결측되는 현실적인 시나리오에서도:[1]

- 30% 결측: 정확도 60.3% vs 58.0% (기존 최고)
- 50% 결측: 정확도 57.0% vs 49.7% (GRU-D)

***

## 5. 모델의 일반화 성능 향상 가능성

### 5.1 교차 인구 일반화 (Cross-Population Generalization)

훈련과 테스트 데이터가 다른 인구집단에서 나올 때:[1]

| 시나리오 | RAINDROP AUROC | 기존 최고 | 개선도 |
|---------|-----------------|---------|-------|
| 젊은층→노인층 | 83.2% | 80.6% | +2.6% |
| 남성→여성 | 85.0% | 80.2% | **+4.8%** |

RAINDROP이 모든 시나리오에서 최고 성능을 보이며, 학습된 센서 의존성이 인구 집단 간에 잘 전이(transfer)됨을 시사합니다.[1]

### 5.2 학습된 그래프의 레이블 민감성

RAINDROP이 학습하는 센서 그래프는 분류 과제에 민감하게 반응합니다:[1]

- **클래스 내 유사성**: 같은 레이블의 샘플들이 평균 거리 $(8.6 \pm 1.7) \times 10^{-5}$
- **클래스 간 거리**: 다른 레이블의 샘플들 $(12.9 \pm 3.1) \times 10^{-5}$

이는 **그래프 구조 자체가 분류 결정에 직접 기여**함을 의미하며, 과제별 최적화된 특징 학습이 가능함을 보여줍니다.[1]

### 5.3 파라미터 공유를 통한 일반화

일반화 능력을 강화하는 메커니즘:[1]

1. **초기 그래프 동일**: 모든 샘플이 완전 연결 그래프로 시작
2. **파라미터 공유**: 메시지 전달의 $R_u, w_u, w_v, D$ 등이 모든 샘플에서 공유
3. **정규화**: $L_r$이 유사한 샘플의 그래프 구조 수렴을 장려

이러한 설계가 **샘플 간 지식 전이**를 가능하게 합니다.

### 5.4 절제 연구(Ablation Study)를 통한 각 요소의 기여도[1]

| 제거 요소 | 정확도 하락 |
|----------|-----------|
| 엣지 가중치 $e_{i,uv}$ | **-7.1%** |
| 메시지 전달 주의 $\alpha^t_{i,uv}$ | -3.9% |
| 시간별 주의 | -1.5% |
| 정규화항 $L_r$ | -0.8% |

**엣지 가중치 제거 시 가장 큰 성능 저하**는 센서 의존성이 모델 성능의 핵심임을 보여줍니다.

***

## 6. 모델의 한계

### 6.1 확장성 제약

- **엣지 수**: 완전 연결 그래프는 $$M^2$$ 엣지(M=센서 수)를 가지므로, 센서가 매우 많은 경우 계산 비용 증가
- **시간별 주의의 이차 복잡도**: 관측이 많으면 $$O(T^2)$$ 계산 (T=타임스탬프)

### 6.2 분포 변화(Domain Shift)에 대한 제한

논문에서 명시: "당신의 연구는 불규칙성 문제에 집중하지, 분포 변화는 아니다"[1]

- 훈련과 테스트 인구집단이 크게 다르면 성능 저하 가능성
- 설정 4(교차 인구 실험)에서는 개선하지만, 극단적 분포 변화는 미처리

### 6.3 그래프 초기화의 완전 연결 가정

- 초기에 모든 센서가 연결되어 있다고 가정하고 50% 엣지 제거
- 사전 도메인 지식이 있다면 이를 활용하기 어려운 구조
- 센서 수가 적으면 이 전략이 효과적이지만, 센서 수가 매우 많으면 비효율적

### 6.4 레이블 정보의 필요성

정규화항 $$L_r$$이 유사 샘플의 그래프 수렴을 장려하는데, 이는 **레이블된 데이터에 의존**합니다. 준지도학습이나 자기지도학습 확장은 미흡합니다.[1]

---

## 7. 일반화 성능 향상을 위한 구체적 메커니즘

### 메커니즘 1: 정규화를 통한 그래프 유사성 학습

$$
L_r = \frac{1}{M^2}\sum_{u,v}\sum_{i,j}\frac{||e_{i,uv} - e_{j,uv}||^2}{(N-1)^2}
$$

이 정규화는 샘플 $$i$$와 $$j$$의 엣지 가중치 차이를 최소화합니다. 결과적으로, 유사한 특성을 가진 샘플들이 유사한 센서 의존성을 학습하게 되어, **새로운 샘플에 대한 일반화가 향상**됩니다.[1]

### 메커니즘 2: 시간 표현의 연속성

삼각함수 기반 시간 인코딩:

$$
p^t_{2k} = \sin\left(\frac{t}{10000^{2k/\xi}}\right), \quad p^t_{2k+1} = \cos\left(\frac{t}{10000^{2k/\xi}}\right)
$$

이는 **연속적인 시간 공간**을 학습하게 하여, 훈련 데이터에 없던 새로운 타임스탐프에도 효과적으로 대응할 수 있게 합니다.[1]

### 메커니즘 3: 센서별 변환 매개변수

$$
h^t_{i,u} = \sigma(x^t_{i,u}R_u)
$$

센서별 $$R_u$$를 사용하면, 각 센서의 값 범위와 분포 특성을 학습합니다. 이는 **데이터 정규화 없이도 센서 이질성을 처리**하게 하여 새로운 환경에서의 적응성을 높입니다.[1]

---

## 8. 앞으로의 연구 영향과 고려사항

### 8.1 연구 영향

**RAINDROP의 기여가 미칠 수 있는 영역:**[1]

1. **의료 AI 발전**: 불규칙 샘플링 환자 데이터를 더 효과적으로 처리하여 조기 질병 진단 개선
2. **그래프 신경망 이론 확대**: 고정 그래프 대신 **학습된 동적 그래프** 사용의 가능성 제시
3. **시계열 분석 일반화**: 선형 시계열 모델(ARIMA)에서 벗어나 **비정형 다변량 시계열의 표준 방법**으로 자리잡을 가능성

### 8.2 향후 연구 시 고려사항

#### **확장성 개선**[1]
- 센서 수가 많은 경우 계산 효율성 향상 필요
- Sparse attention이나 hierarchical graph 구조 고려

#### **도메인 적응(Domain Adaptation)**
- 분포 변화가 있는 상황에 대한 명시적 대응 메커니즘 개발
- 예: 다중 도메인 시나리오에서의 그래프 학습

#### **준지도 및 자기지도 학습 확장**
- 레이블이 부족한 상황에서의 그래프 학습
- 대규모 레이블 없는 의료 데이터 활용

#### **해석 가능성 강화**
- 학습된 센서 의존성에 대한 의료 전문가 검증 프로세스
- 윤리적 의사결정을 위한 투명성 개선

#### **다중 작업 학습(Multi-task Learning)**
- 분류뿐 아니라 회귀, 군집화, 생성 작업에의 확대
- 관련된 여러 예측 작업 동시 학습

#### **시계열 예측(Forecasting)으로의 확장**
- 현재는 분류 중심이나, 미래 관측 예측 기능 추가
- 의료 환경에서 환자 상태 변화 예측

### 8.3 실무 적용 시 주의점

1. **데이터 품질**: 불규칙 샘플링의 원인(센서 고장 vs. 의료 개입)을 구분하여 전처리
2. **하이퍼파라미터**: 엣지 제거 비율(K%), 정규화 가중치(λ) 등이 데이터셋과 작업에 따라 민감하게 변함
3. **불균형 데이터**: P19(4% 양성), P12(93% 양성) 등 심각한 불균형 처리 필요
4. **계산 자원**: GPU 기반 병렬 처리 필요로 일반 컴퓨터 환경에서 제약 가능

***

## 결론

**RAINDROP**은 불규칙하게 샘플링된 다변량 시계열을 처리하기 위한 혁신적 접근법으로, 특히 **센서 간 동적 의존성을 명시적으로 학습**함으로써 일반화 성능을 획기적으로 향상시킵니다. 센서 결측 상황(50% 결측까지)에서도 강건한 성능을 유지하며, 교차 인구 일반화에서도 우수한 결과를 보입니다.[1]

다만, 확장성, 도메인 적응, 준지도학습 등에서는 개선 여지가 있습니다. 향후 연구는 이러한 한계를 극복하면서 의료, 금융, 기후과학 등 다양한 실무 분야에 실질적인 임팩트를 미칠 것으로 예상됩니다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/aa9601fd-c68d-439a-800d-b00501a08d85/2110.05357v2.pdf)
