# CSDI: Conditional Score-based Diffusion Models for Probabilistic Time Series Imputation

### 1. 핵심 주장과 주요 기여[1]

**CSDI**는 조건부 스코어 기반 확산 모델(Conditional Score-based Diffusion Models)을 시계열 데이터의 결측값 대치에 처음으로 적용한 논문입니다. 기존의 스코어 기반 방법들이 대치 작업에 최적화되지 않았던 것과 달리, **CSDI는 관측된 값을 조건으로 하여 직접 조건부 분포를 학습합니다**.[1]

핵심 기여는 다음과 같습니다:

- **조건부 확산 모델의 명시적 설계**: 기존 방법들은 사전 분포에서 근사된 조건부 역과정을 사용했으나, CSDI는 대치 작업에 특화된 조건부 모델을 직접 학습합니다.[1]

- **자기 감독 학습 방식**: 실제 결측 패턴이 알려지지 않았을 때, 마스크된 언어 모델링에서 영감을 받아 관측된 값들을 조건 정보와 대치 대상으로 분리하는 학습 방식을 개발했습니다.[1]

- **다중 작업 적용성**: 시계열 대치뿐 아니라 보간(interpolation)과 확률적 예측(probabilistic forecasting)까지 확장 가능합니다.[1]

- **성능 향상**: 확률적 대치에서 연속 순위 확률 점수(CRPS) 기준 40-65% 개선, 결정론적 대치에서 평균 절대 오차(MAE) 기준 5-20% 개선을 달성했습니다.[1]

---

### 2. 문제 정의, 제안 방법, 모델 구조[1]

#### 2.1 문제 정의

다변량 시계열 데이터 $$X = \{x_{1:K, 1:L}\} \in \mathbb{R}^{K \times L}$$에서 K는 특성(feature) 개수, L은 시계열 길이입니다. 관측 마스크 $$M \in \{0,1\}^{K \times L}$$에서 $$m_{k,l}=0$$이면 결측, $$m_{k,l}=1$$이면 관측입니다.[1]

**확률적 시계열 대치의 목표**: 관측된 값 $$x^{co}_0$$를 조건으로 결측값 $$x^{ta}_0$$의 분포 $$q(x^{ta}_0 | x^{co}_0)$$를 추정하는 것입니다[1].

#### 2.2 기존 확산 모델과의 차이

기존 조건부 확산 모델은 역과정에서 관측된 값에 노이즈를 추가하는 근사 방식을 사용했습니다:

$$p_\theta(x^{ta}_{t-1} | x^{ta}_t, x^{co}_0) \approx p_\theta(x^{ta}_{t-1} | x^{ta}_t)$$

이 방식은 관측된 값의 유용한 정보를 손상시킵니다.[1]

#### 2.3 CSDI의 조건부 역과정[1]

CSDI는 역과정을 다음과 같이 정의합니다:

$$p_\theta(x^{ta}_{0:T} | x^{co}_0) := p(x^{ta}_T) \prod_{t=1}^{T} p_\theta(x^{ta}_{t-1} | x^{ta}_t, x^{co}_0)$$

여기서:
$$x^{ta}_{T} \sim \mathcal{N}(0, I)$$

$$p_\theta(x^{ta}_{t-1} | x^{ta}_t, x^{co}_0) := \mathcal{N}(x^{ta}_{t-1}; \mu_\theta(x^{ta}_t, t | x^{co}_0), \sigma_\theta(x^{ta}_t, t | x^{co}_0)I)$$

#### 2.4 조건부 매개변수화

평균과 분산은 다음과 같이 표현됩니다:

$$\mu_\theta(x^{ta}_t, t | x^{co}_0) = \mu_{DDPM}(x^{ta}_t, t, \epsilon_\theta(x^{ta}_t, t | x^{co}_0))$$

$$\sigma_\theta(x^{ta}_t, t | x^{co}_0) = \sigma_{DDPM}(x^{ta}_t, t)$$

여기서 $$\epsilon_\theta$$는 조건부 노이즈 제거 함수입니다.[1]

#### 2.5 손실 함수[1]

훈련 목표는:

$$\min_\theta L(\theta) = \min_\theta \mathbb{E}_{x_0 \sim q(x_0), \epsilon \sim \mathcal{N}(0,I), t} \||\epsilon - \epsilon_\theta(x^{ta}_t, t | x^{co}_0)||^2_2$$

여기서 $$x^{ta}_t = \sqrt{\alpha_t} x^{ta}_0 + \sqrt{1-\alpha_t} \epsilon$$입니다.[1]

#### 2.6 자기 감독 학습[1]

실제 결측값을 알 수 없으므로, 관측된 값을 두 부분으로 분리합니다:
- **조건부 관측값** $$x^{co}_0$$: 모델이 사용할 조건 정보
- **대치 대상** $$x^{ta}_0$$: 훈련 목표

이는 마스크된 언어 모델링의 원리를 따릅니다.[1]

#### 2.7 모델 아키텍처[1]

**2D 어텐션 메커니즘**:
- **시간 Transformer 계층**: 각 특성별로 시간 의존성 학습
- **특성 Transformer 계층**: 각 시점별로 특성 간 의존성 학습

이 이중 주의 메커니즘은 다변량 시계열의 시간적, 특성 간 상관관계를 포착합니다.[1]

**기본 구성**:
- DiffWave를 기반으로 한 다중 잔차 계층
- 확산 단계: $$T = 50$$
- 노이즈 스케줄: 이차식(quadratic)

**측면 정보(Side Information)**:
- 시간 임베딩 (128 차원)
- 특성 범주 임베딩 (16 차원)

***

### 3. 모델의 일반화 성능 향상과 특징[1]

#### 3.1 훈련 목표 선택 전략

모델의 일반화 성능은 **목표 선택 전략(target choice strategy)**에 따라 달라집니다:[1]

1. **Random 전략**: 결측 패턴을 모를 때, 관측값의 0-100% 범위에서 무작위로 선택
2. **Historical 전략**: 훈련 데이터의 결측 패턴을 활용하여 선택
3. **Mix 전략**: Random과 Historical의 혼합으로 과적합 방지
4. **Test pattern 전략**: 테스트 데이터의 결측 패턴을 알 때 사용

일반화 성능을 위해서는 **Random과 Historical의 혼합** 사용이 권장됩니다.[1]

#### 3.2 불확실성 정량화

CSDI는 샘플링을 통해 **확률적 분포**를 직접 생성하므로, 대치의 불확실성을 자연스럽게 정량화할 수 있습니다. 이는 다음 특징을 제공합니다:[1]

- 예측 신뢰도의 상한과 하한 제공
- 개별 샘플의 신뢰성 평가 가능
- 다운스트림 작업에서 불확실성 활용 가능

#### 3.3 데이터셋 차이에 따른 성능

**헬스케어 데이터** (PhysioNet Challenge 2012):
- 약 80% 결측
- Random 전략으로 우수한 성능 달성
- 결측 패턴이 무작위적

**공기질 데이터** (베이징 PM2.5):
- 약 13% 결측
- Mix 전략으로 최적 성능
- 구조화된 결측 패턴 존재

이는 **데이터의 특성에 맞춘 전략 선택이 일반화 성능을 크게 향상**시킨다는 점을 시사합니다.[1]

#### 3.4 2D 어텐션의 효과

표 7의 절제 연구(ablation study)에서:[1]
- 시간 어텐션 제거: CRPS 0.475 (vs. 0.238)
- 특성 어텐션 제거: CRPS 0.386 (vs. 0.238)
- Bi-RNN 대체: CRPS 0.301 (vs. 0.238)
- 확대 합성곱 대체: CRPS 0.305 (vs. 0.238)

**2D 어텐션이 다른 아키텍처보다 우월**하며, 시간과 특성 의존성이 모두 중요함을 보여줍니다.[1]

#### 3.5 생성 샘플 수의 영향

Figure 7에서 확인할 수 있듯이:[1]
- 5-10개 샘플로도 기준선을 초과
- 50개 이상에서 성능 개선이 한계에 도달
- 100개 샘플 사용으로 충분한 성능 확보

---

### 4. 성능 결과[1]

#### 4.1 확률적 대치 (표 2)

| 데이터셋 | 10% 결측 | 50% 결측 | 90% 결측 | 공기질 |
|---------|---------|---------|---------|--------|
| **Multitask GP** | 0.489 | 0.581 | 0.942 | 0.301 |
| **GP-VAE** | 0.574 | 0.774 | 0.998 | 0.397 |
| **V-RIN** | 0.808 | 0.831 | 0.922 | 0.526 |
| **무조건 확산** | 0.360 | 0.458 | 0.671 | 0.135 |
| **CSDI (제안)** | **0.238** | **0.330** | **0.522** | **0.108** |

CRPS 기준으로 40-65% 개선을 달성했습니다.[1]

#### 4.2 결정론적 대치 (표 3)

MAE 기준으로:
- 헬스케어 10% 결측: 0.271 → 0.217 (20% 개선)
- 헬스케어 90% 결측: 0.606 → 0.481 (21% 개선)
- 공기질: 25.4 → 9.60 (62% 개선)

**저 결측 비율에서 특히 큰 개선**을 보이는데, 이는 더 많은 관측값이 조건부 정보로 활용되기 때문입니다.[1]

#### 4.3 보간 성능 (표 4)

mTANs 대비:
- 10% 결측: 0.526 → 0.380 (28% 개선)
- 50% 결측: 0.567 → 0.418 (26% 개선)
- 90% 결측: 0.689 → 0.556 (19% 개선)

#### 4.4 예측 성능 (표 5)

다섯 개 예측 데이터셋에서:
- Electricity와 Traffic에서 기준선 초과
- 전반적으로 경쟁력 있는 성능 유지

**제한사항**: 예측 작업은 결측이 없는 데이터를 주로 사용하여, RNN 기반 인코더가 더 적합합니다.[1]

***

### 5. 모델의 한계[1]

#### 5.1 계산 효율성

**확산 모델의 느린 샘플링**: 다른 생성 모델 대비 샘플링 속도가 느립니다. 이는 다음으로 완화될 수 있습니다:[1]
- ODE 솔버를 이용한 가속화 (DDIM 등)
- 적응형 샘플링 단계 감소

#### 5.2 제한된 예측 성능

시계열 예측에서 기준선과의 차이가 대치보다 작은 이유:[1]
- 대부분의 예측 데이터셋이 결측값 없음
- RNN 기반 인코더가 이미 충분히 최적화
- CSDI의 조건부 정보 활용 이점이 제한적

#### 5.3 ELBO와 샘플 품질의 불일치

표 8에서 보여지듯이:[1]
- ELBO는 노이즈 스케줄에 매우 민감
- CRPS와 MAE는 스케줄 선택에 영향 거의 없음
- 시계열 데이터의 노이즈가 작은 노이즈 단계에서 추정 어려움

***

### 6. 향후 연구에 미치는 영향 및 고려사항[1]

#### 6.1 연구 영향

**생성 모델의 조건부 학습 패러다임**:
CSDI는 스코어 기반 생성 모델에서 조건부 분포를 직접 학습하는 새로운 접근을 제시했습니다. 이는 이미지, 오디오 등 다른 모달리티에도 확장될 수 있습니다.[1]

**자기 감독 학습의 활용**:
마스크된 언어 모델링의 원리를 시계열 대치에 적용하여, 실제 결측값 없이도 효과적인 훈련이 가능함을 보였습니다.[1]

**확률적 대치의 새로운 가능성**:
불확실성 정량화가 자연스럽게 이루어져, 의료와 금융 분야의 위험 관리에 활용 가능합니다.[1]

#### 6.2 향후 연구 시 고려사항

**1. 계산 효율성 개선**
- DDIM 등 고속 샘플링 기법 통합
- 최소 샘플 수 결정 방법론 개발
- 적응형 확산 단계 최적화

**2. 다운스트림 작업 통합**
- 대치와 분류를 공동 훈련
- 결측값 대치의 불확실성을 분류기에 전파
- 엔드-투-엔드 최적화 전략 수립

**3. 다양한 데이터 모달리티 확장**
- 이미지, 그래프, 텍스트 등으로 확장
- 멀티모달 데이터 대치 방법론 개발
- 도메인별 특성을 반영한 아키텍처 설계

**4. 결측 패턴 분석**
- 일반화 성능과 결측 패턴의 상관관계 분석
- 동적 결측 패턴 처리
- 시간-변하는 결측 메커니즘 모델링

**5. 이론적 분석**
- 조건부 역과정의 수렴 이론 확립
- 자기 감독 학습의 일반화 이론 개발
- 다양한 노이즈 스케줄의 영향 이론화

**6. 실용적 배포**
- 의료 데이터의 프라이버시 보호 메커니즘 통합
- 금융 시계열의 규제 준수 가이드라인 개발
- 계산 제약이 있는 환경에서의 모델 경량화

***

### 7. 결론

CSDI는 조건부 확산 모델을 시계열 대치에 최초로 적용하여, **확률적 대치에서 40-65%, 결정론적 대치에서 5-20%의 성능 향상**을 달성했습니다. 특히 **2D 어텐션 메커니즘과 자기 감독 학습**은 일반화 성능 향상의 핵심입니다.[1]

모델의 주요 강점은 불확실성 정량화, 다양한 결측 패턴 적응, 그리고 확장 가능한 프레임워크입니다. 향후 연구는 계산 효율성, 다운스트림 작업 통합, 그리고 새로운 모달리티로의 확장에 집중해야 합니다.[1]

**의료, 금융, 환경 데이터 분석 등 실제 응용 분야**에서 CSDI는 결측값 처리의 새로운 표준이 될 수 있는 잠재력을 보여줍니다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/9eefe8ee-a798-485f-9197-9f34c7c459ba/2107.03502v2.pdf)
