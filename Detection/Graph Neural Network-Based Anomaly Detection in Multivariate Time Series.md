# Graph Neural Network-Based Anomaly Detection in Multivariate Time Series

### 1. 핵심 주장과 주요 기여도 요약

이 논문의 핵심 주장은 **사이버-물리 시스템(Cyber-Physical Systems, CPS)에서 센서 간의 복잡한 상호 관계를 명시적으로 학습하고, 이러한 관계로부터의 편차를 감지하여 이상 탐지를 수행해야 한다**는 것입니다.[1]

논문의 주요 기여는 다음과 같습니다:[1]

**Graph Deviation Network (GDN)** 개발: 센서 간의 의존성 관계를 그래프로 학습하면서 동시에 이 관계로부터의 편차를 식별하고 설명할 수 있는 주의(attention) 기반의 그래프 신경망을 제안합니다.

실제 데이터 검증: 실제 물 처리 시설의 센서 데이터(SWaT, WADI)를 활용하여 기존 방법 대비 더 높은 정확도로 이상을 탐지함을 입증합니다.

해석 가능성 제공: 센서 임베딩, 학습된 그래프 구조, 주의 가중치를 통해 이상의 근본 원인을 규명할 수 있는 설명 가능한 모델을 제시합니다.

***

### 2. 문제 정의, 제안 방법, 모델 구조 및 성능

#### 2.1 해결하고자 하는 문제

기존의 깊은 학습 기반 이상 탐지 방법(Autoencoder, GAN, LSTM)들은 다음 두 가지 한계를 가집니다:[1]

센서 간의 구조화된 관계를 명시적으로 학습하지 못하므로, 복잡한 비선형 상호 관계를 충분히 포착하지 못합니다.

그래프 신경망을 단순 적용할 경우, 서로 다른 특성의 센서들을 동일한 모델 파라미터로 처리하고, 처음부터 그래프 구조를 알아야 한다는 문제가 있습니다.

따라서 이 논문은 **초기에 미지의 센서 간 관계를 자동으로 학습하면서, 각 센서의 고유한 특성을 반영할 수 있는 방법**을 제안하고자 합니다.

#### 2.2 제안하는 방법론

**GDN의 4단계 구조:**[1]

**단계 1: 센서 임베딩 (Sensor Embedding)**

각 센서의 특성을 표현하는 임베딩 벡터를 정의합니다:

$$v_i \in \mathbb{R}^d, \quad i \in \{1, 2, \cdots, N\}$$

여기서 $$v_i$$는 i번째 센서의 임베딩이며, 유사한 동작을 하는 센서들은 유사한 임베딩 값을 가지도록 학습됩니다.[1]

**단계 2: 그래프 구조 학습 (Graph Structure Learning)**

센서 i와 후보 센서 j 간의 정규화된 유사도를 계산합니다:[1]

$$e_{ji} = \frac{v_i^\top v_j}{\|v_i\| \cdot \|v_j\|} \quad \text{for } j \in C_i$$

각 센서에 대해 상위 k개의 유사도를 가진 센서들만 선택하여 인접 행렬을 구성합니다:[1]

$$A_{ji} = \mathbb{1}\{j \in \text{TopK}(\{e_{ki} : k \in C_i\})\}$$

이는 희소(sparse)한 그래프 구조를 학습하면서도 센서 간의 의존성 관계를 동적으로 파악합니다.

**단계 3: 그래프 주의 기반 예측 (Graph Attention-Based Forecasting)**

시간 t에서의 센서 i의 집계된 표현을 다음과 같이 계산합니다:[1]

$$z_i^{(t)} = \text{ReLU}\left(\alpha_{i,i} W x_i^{(t)} + \sum_{j \in N(i)} \alpha_{i,j} W x_j^{(t)}\right)$$

여기서 주의 계수 $$\alpha_{i,j}$$는 센서 임베딩을 활용하여 계산됩니다:[1]

$$g_i^{(t)} = v_i \oplus W x_i^{(t)}$$

$$\pi(i,j) = \text{LeakyReLU}\left(a^\top [g_i^{(t)} \oplus g_j^{(t)}]\right)$$

$$\alpha_{i,j} = \frac{\exp(\pi(i,j))}{\sum_{k \in N(i) \cup \{i\}} \exp(\pi(i,k))}$$

기호 $$\oplus$$는 벡터 연결(concatenation)을 나타냅니다. 이 메커니즘은 센서의 고유한 특성을 반영하면서 이웃 센서들의 정보를 비대칭적으로 통합합니다.

최종 예측은 다음과 같이 수행됩니다:[1]

$$\hat{s}^{(t)} = f_\theta\left(\{v_1 \circ z_1^{(t)}, \cdots, v_N \circ z_N^{(t)}\}\right)$$

기호 $$\circ$$는 요소별 곱셈(element-wise multiplication)입니다. 훈련 손실 함수는 평균 제곱 오차(MSE)입니다:[1]

$$L_{\text{MSE}} = \frac{1}{T_{\text{train}} - w} \sum_{t=w+1}^{T_{\text{train}}} \left\|\hat{s}^{(t)} - s^{(t)}\right\|_2^2$$

**단계 4: 그래프 편차 점수 (Graph Deviation Scoring)**

각 센서 i의 이상도 점수를 계산합니다:[1]

$$\text{Err}_i(t) = |s_i^{(t)} - \hat{s}_i^{(t)}|$$

다양한 센서의 서로 다른 스케일을 고려하여 강건한 정규화를 수행합니다:[1]

$$a_i(t) = \frac{\text{Err}_i(t) - \tilde{\mu}_i}{\tilde{\sigma}_i}$$

여기서 $$\tilde{\mu}_i$$와 $$\tilde{\sigma}_i$$는 각각 중앙값(median)과 사분위수 범위(IQR)입니다. 최종 이상도 점수는 최대 함수를 사용하여 집계합니다:[1]

$$A(t) = \max_i a_i(t)$$

이동 평균을 적용하여 점수를 부드럽게 하고, 검증 데이터의 최대값을 임계값으로 설정하여 이상을 판별합니다.

#### 2.3 모델 구조의 특징

| 구성 요소 | 특징 |
|---------|------|
| **센서 임베딩** | 각 센서의 고유한 특성을 다차원 벡터로 표현하여 이질적인 센서들을 유연하게 모델링 |
| **적응적 그래프 학습** | 임베딩 벡터의 유사도를 기반으로 센서 간의 의존성을 자동으로 학습하고 희소 그래프 생성 |
| **주의 메커니즘** | 센서 임베딩을 활용한 비대칭적 주의 가중치로 이웃 센서의 영향도를 동적으로 조정 |
| **예측 기반 이상 탐지** | 정상 동작의 예측값과 실제값의 편차를 통해 이상을 식별하고 설명 가능하게 함 |

#### 2.4 성능 향상

실험 결과 GDN은 두 개의 실제 물 처리 시설 센서 데이터에서 기존 방법들을 능가합니다:[1]

| 방법 | SWaT F1 점수 | WADI F1 점수 |
|------|-------------|-------------|
| PCA | 0.23 | 0.10 |
| KNN | 0.08 | 0.08 |
| Feature Bagging | 0.10 | 0.09 |
| Autoencoder | 0.61 | 0.34 |
| DAGMM | 0.39 | 0.36 |
| LSTM-VAE | 0.74 | 0.25 |
| MAD-GAN | 0.77 | 0.37 |
| **GDN** | **0.81** | **0.57** |

SWaT 데이터에서 99.35%의 정밀도(Precision)를 달성하고, 더 불균형하고 고차원인 WADI 데이터에서는 기존 최고 성능 대비 54% 높은 F1 점수를 기록합니다.[1]

**절제 연구(Ablation Study) 결과:**[1]

- 학습된 그래프를 완전 그래프(complete graph)로 대체하면 성능이 저하되며, 특히 WADI에서 현저합니다 (F1: 0.57 → 0.51).
- 센서 임베딩을 제거하면 주의 메커니즘의 효과가 감소합니다 (SWaT F1: 0.81 → 0.76).
- 주의 메커니즘을 제거하고 동일 가중치로 이웃을 처리하면 가장 큰 성능 저하가 발생합니다 (SWaT F1: 0.81 → 0.68), 이는 센서의 이질성을 고려한 설계의 중요성을 입증합니다.

#### 2.5 모델의 한계

**1. 제한된 데이터 평가:**

논문은 두 개의 물 처리 시설 센서 데이터(SWaT, WADI)만을 사용하여 평가합니다. 이는 다른 유형의 사이버-물리 시스템(전력망, 교통 시스템, 데이터 센터 등)에서의 일반화 성능을 보장하지 못합니다.[1]

**2. 하이퍼파라미터 민감성:**

TopK 값(k) 및 임베딩 크기(d), 숨은 레이어 크기 등이 실험별로 다르게 설정됩니다. 이러한 하이퍼파라미터의 선택이 성능에 미치는 영향과 최적 선택 방법에 대한 상세 분석이 부족합니다.[1]

**3. 임계값 설정의 단순성:**

이상 판별을 위한 임계값을 검증 데이터의 최대값으로 단순하게 설정합니다. 이는 실제 운영 환경에서 새로운 유형의 이상에 대한 적응성이 제한될 수 있습니다.[1]

**4. 온라인 학습 미지원:**

모델은 훈련 후 고정되며, 새로운 센서 추가나 시스템 변화에 대한 온라인 재학습을 직접 다루지 않습니다.[1]

**5. 계산 복잡도:**

그래프 구조 학습 및 주의 메커니즘 계산으로 인한 계산 비용이 명시적으로 분석되지 않습니다. 대규모 센서 시스템에서의 확장성에 대한 우려가 있습니다.

***

### 3. 일반화 성능 향상 가능성 분석

#### 3.1 현재 강점

**관계 학습을 통한 강건한 표현:**

GDN은 센서 간의 관계를 명시적으로 학습하므로, 정상 상태의 복잡한 패턴을 포착합니다. 이를 통해 새로운 데이터에서 정상과 이상의 경계가 명확해지는 경향이 있습니다.[1]

**센서 임베딩의 의미성:**

t-SNE 시각화 결과에서 보듯이, 같은 기능을 수행하는 센서들이 임베딩 공간에서 자동으로 군집을 형성합니다. 이는 도메인 특성을 학습했음을 시사합니다.[1]

**해석 가능성 기반의 신뢰도:**

주의 가중치와 예측값 비교를 통해 이상의 원인을 규명하므로, 운영자의 신뢰도 기반의 일반화가 가능합니다.[1]

#### 3.2 일반화 성능 제한 요인 및 개선 방향

**1. 도메인 외(Out-of-Domain) 이상에 대한 취약성:**

현재 모델은 훈련 중에 본 정상 패턴의 역함수로만 이상을 정의합니다. 예를 들어, 훈련 데이터에 없는 새로운 유형의 공격이나 시스템 고장에 대해서는 감지 능력이 제한될 수 있습니다.

**개선 방안:** 불확실성 추정(Uncertainty Estimation) 또는 신뢰도 점수(Confidence Score)를 추가하여, 모델이 이전에 본 적 없는 이상에 대해 낮은 신뢰도를 반환하도록 설계할 수 있습니다.[1]

**2. 시스템 진화에 대한 적응:**

물리 시스템이 시간에 따라 변화하면(센서 교체, 설정 변경 등), 이전에 학습한 그래프 구조와 임베딩이 더 이상 유효하지 않을 수 있습니다.

**개선 방안:** 온라인 학습(Online Learning) 또는 연속 학습(Continual Learning) 프레임워크를 적용하여 모델이 새로운 정상 상태에 점진적으로 적응하도록 개선할 수 있습니다. 또는 분포 이동 감지(Distribution Shift Detection)를 추가하여 모델의 재훈련 필요성을 자동으로 판단할 수 있습니다.

**3. 불균형한 이상 클래스에 대한 성능:**

WADI 데이터는 단 5.99%의 이상만 포함하고 있으며, GDN의 재현율(Recall)은 40.19%로 낮습니다. 이는 극소수의 이상을 놓칠 위험이 있습니다.[1]

**개선 방안:**

- **가중 손실 함수(Weighted Loss):** 드물고 심각한 이상에 더 높은 가중치를 부여합니다.
- **이상 합성(Anomaly Synthesis):** 정상 데이터로부터 합성된 이상 샘플을 생성하여 훈련 데이터를 증강합니다.
- **우선순위 이상 탐지(Prioritized Anomaly Detection):** 심각도가 높은 이상에 더 높은 감지 확률을 할당합니다.

**4. 센서 간 숨겨진 요인(Latent Factors):**

센서 간의 관계가 직접적인 인과 관계가 아닌 제3의 요인에 의해 발생할 수 있습니다. 현재 GDN은 관측된 상관성만 학습합니다.

**개선 방안:** 인과 그래프 학습(Causal Graph Learning)이나 구조적 인과 모델(Structural Causal Models)을 통합하여, 인과 관계를 명시적으로 학습할 수 있습니다.

**5. 그래프 구조의 고정성:**

학습 후 그래프 구조가 고정되어, 시간에 따른 센서 간 관계의 변화를 반영하지 못합니다.

**개선 방안:** 동적 그래프 신경망(Dynamic GNN) 또는 시간-변하는 그래프(Time-Varying Graph)를 사용하여 주기적으로 또는 조건부로 그래프를 업데이트할 수 있습니다.

***

### 4. 향후 연구에 미치는 영향 및 고려 사항

#### 4.1 연구 영향

**1. 센서 데이터 이상 탐지의 새로운 패러다임:**

GDN은 단순 통계 또는 시계열 예측 기반에서 벗어나, 센서 간의 관계 학습을 중심으로 한 이상 탐지의 중요성을 입증합니다. 향후 연구는 이를 다른 영역(의료 신호, 금융 데이터, 엣지 컴퓨팅 등)에 확대 적용할 수 있습니다.[1]

**2. 해석 가능한 AI(XAI)의 사례:**

주의 메커니즘과 임베딩을 통한 명확한 설명 가능성은 산업 현장에서의 AI 도입에 대한 신뢰를 높입니다. 향후 연구는 더욱 정교한 해석 가능성 메커니즘을 개발할 수 있습니다.

**3. 그래프 신경망의 확장:**

기존 GNN의 고정 그래프 구조 가정을 극복한 구조 학습 접근은 다른 그래프 학습 문제에 적용될 수 있습니다.

#### 4.2 향후 연구 시 고려할 점

**1. 도메인 특화 연구:**

물 처리뿐 아니라 전력 시스템, 교통 네트워크, 항공 엔진 등 다양한 산업용 센서 데이터에 대한 평가가 필요합니다.

**2. 하이퍼파라미터 자동 선택:**

TopK 값, 임베딩 차원 등의 하이퍼파라미터를 자동으로 선택하는 방법론을 개발해야 합니다. 또는 다양한 하이퍼파라미터 조합에 대한 견고성(Robustness)을 분석해야 합니다.

**3. 부분적 관찰(Partial Observation) 처리:**

일부 센서가 고장나거나 데이터가 누락된 현실적 상황에서의 모델 성능을 평가해야 합니다.

**4. 전이 학습(Transfer Learning) 적용:**

한 센서 시스템에서 학습한 모델을 다른 시스템에 적용할 때의 성능 저하를 최소화하는 방법을 개발해야 합니다.

**5. 실시간 처리 최적화:**

사이버-물리 시스템의 실시간 운영을 위해 계산 복잡도를 분석하고 경량 모델(Lightweight Model)을 개발해야 합니다.

**6. 적대적 공격(Adversarial Attack) 견고성:**

모델이 정교한 공격으로부터 얼마나 견고한지 평가하고, 적대적 견고성을 강화하는 방법을 개발해야 합니다.

**7. 설명의 신뢰성 검증:**

주의 가중치와 그래프 구조가 정말로 물리적 인과 관계를 올바르게 반영하는지 도메인 전문가를 통해 검증해야 합니다.

***

## 결론

Graph Deviation Network는 **센서 간의 관계를 명시적으로 학습하면서 이상을 탐지하는 새로운 방법**으로서, 높은 정확도와 해석 가능성을 동시에 제공합니다. 특히 센서 임베딩을 통한 이질성 처리와 적응적 그래프 학습은 현실의 복잡한 센서 시스템을 모델링하는 데 효과적입니다.[1]

그러나 제한된 데이터 평가, 하이퍼파라미터 민감성, 정적 그래프 구조 등의 한계가 일반화 성능에 영향을 미칩니다. 향후 연구는 온라인 학습, 도메인 외 이상 감지, 전이 학습 등을 통해 모델의 적응성과 견고성을 강화해야 하며, 다양한 산업 분야에서의 검증을 통해 실용성을 확대할 수 있을 것으로 기대됩니다.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/34d104cc-6ee2-4aff-ac57-8b1179c938b6/2106.06947v1.pdf)
