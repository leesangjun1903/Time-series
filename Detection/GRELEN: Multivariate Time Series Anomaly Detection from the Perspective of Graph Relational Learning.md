# GRELEN: Multivariate Time Series Anomaly Detection from the Perspective of Graph Relational Learning

### 핵심 주장 및 주요 기여

GRELEN(Graph Relational Learning Network)은 다변량 시계열의 이상 탐지를 **센서 간 의존 관계 학습**의 관점에서 접근하는 혁신적인 프레임워크입니다. 기존 방법들이 개별 센서의 행동에만 집중하거나 의존 관계를 명시적으로 모델링하지 못한 반면, GRELEN은 센서 간의 의존 구조를 직접 학습하고 이를 이상 탐지 점수에 반영합니다.[1]

주요 기여는 다음과 같습니다:

**VAE 기반 확률적 관계 그래프 학습**: VAE의 잠재 변수를 활용하여 센서 간의 의존 관계를 확률적으로 학습합니다.[1]

**그래프 관계 학습 기반 이상 탐지**: 학습된 의존 구조를 명시적으로 활용한 복합 이상 점수를 제안했습니다.[1]

**우수한 성능과 해석 가능성**: 4개의 실제 데이터셋에서 탐지 정확도, 이상 진단, 모델 해석성 측면에서 우수성을 입증했습니다.[1]

---

### 해결하려는 문제

다변량 시계열 이상 탐지의 핵심 과제는 **복잡한 시스템에서 센서 간의 의존 관계 변화를 포착**하는 것입니다. 예를 들어, 수처리 시스템에서 한 센서에 이상이 발생하면 다른 센서들과의 관계가 변화하며, 이러한 관계 변화가 이상의 중요한 지표가 됩니다.[1]

기존 방법들의 한계:

**예측 기반 방법**: 센서 간 의존성을 고려하지만, 단순 예측 오차만을 이상 점수로 사용하여 관계 변화를 명시적으로 반영하지 못합니다.[1]

**재구성 기반 방법**: LSTM-VAE, GAN 등을 사용하지만 변수 간 의존 관계를 명시적으로 모델링하지 않습니다.[1]

**그래프 학습 방법**: GDN 등은 "top-k" 이웃만 유지하여 정보 손실이 발생하고, 학습된 그래프를 이상 탐지에 직접 활용하지 않습니다.[1]

---

### 제안하는 방법

#### 문제 정식화

$$N$$개의 센서를 가진 시스템에서 $$T$$ 타임스탬프 동안 수집된 데이터를 $$\mathbf{X} \in \mathbb{R}^{N \times T}$$로 표현합니다. 슬라이딩 윈도우 $$w$$를 사용하여 샘플 $$\mathbf{S}^t = \mathbf{X}^{t-w+1:t}$$를 생성하고, 모델 $$f$$는 각 타임스탬프에 대해 이진 레이블 $$y^t \in \{0, 1\}$$을 출력합니다.[1]

#### 모델 구조

GRELEN은 VAE 구조를 따르며 세 가지 주요 모듈로 구성됩니다:[1]

**1. 인코더 (Encoder)**

시계열 입력 $$\mathbf{S}^t$$에서 시간적 특징을 추출하고, 멀티헤드 셀프 어텐션 메커니즘을 사용하여 의존 관계 분포를 학습합니다.[1]

선형 레이어를 통한 특징 추출:

$$
\mathbf{H}^t = \mathbf{S}^t \mathbf{W}_l
$$

멀티헤드 어텐션으로 의존 관계 파라미터 계산:

$$
\mathbf{Q}^t = \mathbf{H}^t \mathbf{W}_q, \quad \mathbf{K}^t = \mathbf{H}^t \mathbf{W}_k
$$

$$
\boldsymbol{\Theta}^t = \text{Softmax}(\text{Concat}(\text{head}_1, \ldots, \text{head}_{h_0}))
$$

$$
\text{head}_h = \mathbf{Q}^t_h (\mathbf{K}^t_h)^T, \quad 1 \leq h \leq h_0
$$

여기서 $$h_0$$는 학습하려는 의존 관계 유형의 수이며, $$\boldsymbol{\Theta}^t \in \mathbb{R}^{h_0 \times N \times N}$$는 각 센서 쌍 간의 의존 관계 확률 파라미터입니다.[1]

**2. 샘플링 (Sampling with Gumbel-Softmax)**

이산적인 잠재 변수 $$\mathbf{z}^t_{ij}$$를 생성하기 위해 Gumbel-Softmax 재파라미터화 기법을 사용합니다:[1]

$$
\mathbf{z}^t_{ij} = \text{softmax}\left(\frac{\boldsymbol{\theta}^t_{ij} + \mathbf{g}}{\tau}\right)
$$

여기서 $$\mathbf{g}$$는 Gumbel(0,1) 분포에서 샘플링된 벡터이고, $$\tau$$는 온도 파라미터입니다. 이를 통해 역전파가 가능한 연속 근사를 얻습니다.[1]

**3. 디코더 (Decoder)**

학습된 의존 관계 그래프를 기반으로 원본 시계열을 재구성합니다. $$h_0$$개의 그래프 중 하나는 "null 의존성"으로 희소성을 보장하고, 나머지 $$h_0-1$$개는 DCGRU(Diffusion Convolutional GRU)의 인접 행렬로 사용됩니다.[1]

재구성 분포:

$$
p_\psi(\mathbf{X}^{t'+1}|\mathbf{X}^{t'}, \ldots, \mathbf{X}^{t-w+1}, \mathbf{Z}^t) = \mathcal{N}(\boldsymbol{\mu}^{t'+1}, \sigma^2 \mathbf{I})
$$

DCGRU의 그래프 합성곱 연산:

$$
\mathbf{W}_Q \star_A \mathbf{Y} = \sum_{k=0}^{K} \left[ w^Q_{k,1} (\mathbf{D}^{-1}_O \mathbf{A})^k + w^Q_{k,2} (\mathbf{D}^{-1}_I \mathbf{A}^T)^k \right] \mathbf{Y}
$$

여기서 $$\mathbf{D}_O$$와 $$\mathbf{D}_I$$는 각각 out-degree와 in-degree 행렬이며, $$K$$는 확산 차수입니다.[1]

#### 목적 함수

VAE의 ELBO(Evidence Lower Bound)를 최대화합니다:[1]

$$
\mathcal{L} = \mathbb{E}_{q_\phi(\mathbf{Z}^t|\mathbf{S}^t)}[\log p_\psi(\mathbf{S}^t|\mathbf{Z}^t)] - \text{KL}(q_\phi(\mathbf{Z}^t|\mathbf{S}^t) \| p_\psi(\mathbf{Z}^t))
$$

**재구성 손실** $$\mathcal{L}_1$$:

$$
\mathcal{L}_1 = -\sum_{i=1}^{N} \sum_{t'=t-w+2}^{t} \frac{\|\mathbf{x}^{t'}_i - \boldsymbol{\mu}^{t'}_i\|^2}{2\sigma^2}
$$

**KL 발산 손실** $$\mathcal{L}_2$$ (희소성 제약):

$$
\mathcal{L}_2 = \sum_{k=1}^{h_0} \tilde{p}^t_k \log\left(\frac{\tilde{p}^t_k}{\tilde{q}_k}\right)
$$

여기서 $$\tilde{p}^t_k = \sum_{i=1}^{N} \sum_{j=1}^{N} z^t_{i,j}(k)$$는 학습된 의존 관계가 유형 $$k$$에 속할 확률의 합이며, $$\tilde{q} = [0.91, 0.03, 0.03, 0.03]$$는 사전 분포입니다.[1]

#### 이상 점수

**GReLeN Loss**: KL 발산 손실 $$\mathcal{L}_2$$를 사용하여 전역적인 의존 구조 변화를 포착합니다.[1]

**GReLeN Degree**: 학습된 그래프에서 모든 센서의 in/out degree 합을 사용합니다:[1]

$$
\text{Anomaly Score} = \sum_{i=1}^{N} (d^{\text{in}}_i + d^{\text{out}}_i)
$$

이동 평균 필터를 적용하여 급격한 이상 변화를 강조하고 점진적 변화는 제거합니다.[1]

---

### 성능 향상

#### 실험 결과

4개의 실제 데이터셋(SWaT, WADI, SMD, PSM)에서 평가한 결과, GRELEN Degree가 **평균 F1 점수 85.5%**로 최고 성능을 달성했습니다:[1]

- **SWaT**: F1 89.1% (Precision 95.6%, Recall 83.5%)
- **WADI**: F1 68.2% (Precision 77.3%, Recall 61.3%)
- **SMD**: F1 91.5% (Precision 88.2%, Recall 95.1%)
- **PSM**: F1 93.1% (Precision 94.2%, Recall 92.1%)

SOTA 베이스라인 대비 우수한 성능:
- OmniAnomaly (77.1%), USAD (72.9%), GDN (62.3%), RCoders (75.1%) 대비 향상[1]
- 특히 낮은 이상 비율의 WADI 데이터셋에서도 높은 Recall 달성[1]

#### 그래프 관계 학습의 효과

**정보 손실 방지**: GDN의 "top-k" 이웃 선택 방식과 달리, GRELEN은 모든 잠재적 이웃을 유지하고 사전 분포로 희소성을 제어하여 정보 손실을 방지합니다.[1]

**Top-k 제약 비교**: GRELEN Topk (F1 79.6%) 대비 GRELEN Degree (F1 85.5%)가 더 높은 성능을 보였습니다.[1]

**의존 구조 변화 포착**: 정상 상태에서는 희소한 의존 구조를 학습하지만, 이상 상태에서는 센서 간 의존성이 증가하는 패턴을 명확히 포착했습니다.[1]

#### 모델 해석 가능성

**도메인 지식과 일치**: SWaT 시스템에서 학습된 그래프가 실제 공정 다이어그램과 일치했습니다:[1]
- 첫 4개 센서(P1 단계)가 다른 센서들과 강한 의존성을 보임
- 동일 공정 단계(P3)의 센서들이 서로 강한 의존성을 가짐

**이상 진단 능력**: 공격받은 센서뿐만 아니라 하류 공정의 관련 이상까지 탐지하여 운영 로그를 넘어서는 진단 정보를 제공합니다.[1]

***

### 한계

논문에서 명시적으로 언급된 한계는 다음과 같습니다:

**글로벌 손실의 한계**: GReLeN Loss는 전역적인 의존 구조 편차에 집중하여 미세한 이상을 놓칠 수 있습니다.[1]

**하이퍼파라미터 민감도**: 데이터셋마다 DCGRU 레이어 수(SWaT: 2, 기타: 1)를 다르게 설정해야 했으며, 사전 분포 파라미터 설정이 성능에 영향을 미칩니다.[1]

**임계값 설정**: 그리드 서치를 통해 최적의 이상 탐지 임계값을 찾아야 하며, 실시간 적응적 임계값 설정 방법이 필요합니다.[1]

추가로 고려할 수 있는 한계:

**계산 복잡도**: 멀티헤드 어텐션과 DCGRU를 결합하여 센서 수가 많은 경우 계산 비용이 증가할 수 있습니다.

**동적 그래프 구조**: 모델이 각 타임스탬프에서 그래프를 학습하지만, 장기적인 시간적 변화 패턴을 명시적으로 모델링하지는 않습니다.

---

### 일반화 성능 향상 가능성

#### 데이터셋 간 견고성

GRELEN은 4개의 서로 다른 특성을 가진 데이터셋에서 균형잡힌 성능을 보였습니다:[1]
- 센서 수: 26개(PSM) ~ 112개(WADI)
- 이상 비율: 4.16%(SMD) ~ 27.76%(PSM)
- 모든 데이터셋에서 상위 성능 달성

#### 일반화를 위한 핵심 설계

**데이터 기반 그래프 학습**: 사전 정의된 그래프 구조에 의존하지 않고 데이터로부터 자동으로 학습하여 다양한 시스템에 적용 가능합니다.[1]

**확률적 모델링**: VAE의 확률적 프레임워크가 불확실성을 자연스럽게 처리하여 다양한 데이터 분포에 강건합니다.[1]

**희소성 제약**: 사전 분포를 통한 희소성 제약이 과적합을 방지하고 일반화 성능을 향상시킵니다.[1]

#### 개선 방향

**전이 학습**: 한 시스템에서 학습한 의존 관계 패턴을 유사한 시스템에 전이하는 방법 연구가 필요합니다.

**도메인 적응**: 서로 다른 도메인 간의 분포 차이를 줄이는 적응 기법을 통합할 수 있습니다.

**앙상블 접근**: 여러 데이터셋에서 학습한 모델을 앙상블하여 일반화 성능을 더욱 향상시킬 수 있습니다.

**메타 학습**: 소수의 샘플로 새로운 시스템에 빠르게 적응할 수 있는 메타 학습 프레임워크를 적용할 수 있습니다.

***

### 앞으로의 연구에 미치는 영향

#### 이론적 기여

**그래프 관계 기반 이상 탐지 패러다임**: 센서 간 의존 관계를 명시적으로 모델링하고 이를 이상 점수에 직접 활용하는 새로운 접근법을 제시했습니다. 이는 향후 연구에서 관계 변화를 중심으로 한 이상 탐지 방법론의 발전을 촉진할 것입니다.[1]

**VAE와 GNN의 효과적 결합**: VAE의 잠재 변수로 그래프 구조를 학습하는 방법론은 다른 구조화된 데이터 분석에도 응용 가능합니다.[1]

#### 실용적 가치

**해석 가능한 이상 진단**: 학습된 그래프 구조가 도메인 지식과 일치하여 실무자가 이상 원인을 이해하고 대응 조치를 취하는 데 도움을 줍니다.[1]

**실시간 모니터링**: 온라인 테스트 모듈이 추가 학습 없이 데이터 스트림을 처리하여 실시간 시스템 모니터링에 적합합니다.[1]

#### 향후 연구 시 고려할 점

**시간적 동적성 강화**: 현재 모델은 각 타임스탬프에서 독립적으로 그래프를 학습합니다. 시간에 따른 그래프 진화를 명시적으로 모델링하는 동적 그래프 학습 방법을 통합하면 장기 패턴 포착이 가능할 것입니다.

**확장성 개선**: 센서 수가 매우 많은 대규모 시스템에서 계산 효율성을 높이기 위해 계층적 그래프 학습이나 효율적인 어텐션 메커니즘(예: Sparse Transformer) 적용을 고려해야 합니다.

**다중 모달 통합**: 센서 데이터 외에 텍스트 로그, 이미지 등 다양한 모달리티를 통합하여 더 포괄적인 시스템 이해가 가능합니다.

**반지도 학습**: 소량의 레이블 데이터를 활용하여 이상 유형을 구분하고 더 정교한 진단을 제공하는 방법을 연구할 수 있습니다.

**인과 관계 학습**: 단순 의존 관계를 넘어 센서 간 인과 관계를 학습하면 근본 원인 분석에 더욱 효과적일 것입니다.

**적응적 임계값**: 고정된 임계값 대신 시스템 상태에 따라 동적으로 조정되는 적응적 임계값 메커니즘을 개발하면 실용성이 향상될 것입니다.

GRELEN은 다변량 시계열 이상 탐지 분야에 그래프 관계 학습이라는 새로운 시각을 제시했으며, 이를 기반으로 더욱 정교하고 해석 가능한 이상 탐지 시스템 개발이 가능할 것입니다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/75b23d71-e0ca-45e5-a9e4-364b6ed541ff/0332.pdf)
