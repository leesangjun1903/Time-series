# Time Series Anomaly Detection for Cyber-physical Systems via Neural System Identification and Bayesian Filtering

## 핵심 주장 및 주요 기여

이 논문의 **핵심 주장**은 cyber-physical systems(CPS)의 시계열 데이터에서 센서 노이즈와 과정 노이즈가 존재할 때, 신경망 기반의 시스템 식별(system identification)과 베이지안 필터링을 결합하면 기존의 잔차 오류 기반(residual error-based) 방법들보다 더욱 강건하고 우수한 이상 탐지가 가능하다는 것입니다.[1]

**주요 기여**는 다음과 같습니다:[1]

1. **밀도 기반 이상 탐지 프레임워크**: 신경망으로 학습한 상태 공간 모델(state-space model) 위에 베이지안 필터링을 적용하여, 센서 노이즈에 강건한 밀도 기반 이상 탐지 방법 제시

2. **하이브리드 접근법**: 신경망의 표현력(expressiveness)과 베이지안 필터의 불확실성 추적(uncertainty tracking) 능력을 결합하여 복잡한 시스템 동역학을 정확하게 모델링

3. **실제 CPS 데이터에서의 우수한 성능**: 3개의 실제 산업 CPS 데이터셋(PUMP, WADI, SWAT)에서 기존 최신 방법 대비 2.9~7.6% F1 스코어 향상

4. **재현 가능한 연구**: 데이터와 코드를 GitHub에 공개하여 재현성 확보

---

## 문제 정의 및 제안 방법

### 기존 방법의 한계

전통적으로 CPS의 이상 탐지는 선형 상태 공간 모델과 칼만 필터(Kalman filter)를 사용합니다. 그러나 이들은 다음과 같은 제한사항이 있습니다:[1]

- **시스템 식별의 어려움**: 시스템 동역학을 정의하는 수학적 모델을 구축하려면 도메인 전문 지식이 필요
- **적응성 부족**: 현대의 복잡한 CPS의 비선형 동역학을 정확하게 포착하기 어려움
- **일반성 부족**: 각 시스템마다 맞춤형 모델이 필요하여 다양한 CPS에 적용하기 어려움

한편, 재구성 오류(reconstruction error) 기반이나 예측 오류(prediction error) 기반의 신경망 방법들은 센서 노이즈가 많을 때 노이즈를 이상으로 오인하는 경향이 있습니다.[1]

### 제안 방법: NSIBF (Neural System Identification and Bayesian Filtering)

논문은 **신경망 기반 시스템 식별**과 **베이지안 필터링**을 결합한 방법을 제시합니다.[1]

#### 1. 신경망 기반 시스템 식별

특별히 설계된 신경망 구조는 3개의 서브네트워크로 구성됩니다:[1]

- **Encoder 네트워크** ($$\phi_\theta$$): 시간 $$t-1$$의 센서 측정값 $$x_{t-1}$$을 입력받아 저차원 은닉 상태 $$z_{t-1}$$로 인코딩
  
  $$z_{t-1} = \phi_\theta(x_{t-1})$$

- **Context 네트워크** ($$\psi_\phi$$): 슬라이딩 윈도우 길이 $$\tau$$ 동안의 센서 측정값과 액추에이터 상태를 LSTM으로 인코딩하여 시간적 맥락 $$h_{t-1}$$ 생성
  
  $$h_{t-1} = \psi_\phi(x_{1:t-1}, u_{1:t-1})$$

- **Transition 네트워크** ($$\chi_\psi$$): 은닉 상태 $$z_{t-1}$$과 시간적 맥락 $$h_{t-1}$$을 입력받아 다음 시간의 은닉 상태 예측
  
  $$z_t = \chi_\psi(z_{t-1}, h_{t-1})$$

- **Decoder 네트워크** ($$\phi_\theta$$): Encoder와 가중치를 공유하며, 은닉 상태를 센서 측정값으로 디코딩

#### 2. 손실 함수

신경망은 다음의 3항 손실 함수로 학습됩니다:[1]

$$\mathcal{L} = \lambda_1 \|x_{t-1} - \hat{x}_{t-1}\|_2^2 + \lambda_2 \|x_t - \hat{x}_t\|_2^2 + \lambda_3 \|z_t - z_{t-1}\|_2^2$$

여기서:
- 첫 번째 항: 센서 측정값의 **재구성 오류**
- 두 번째 항: 센서 측정값의 **예측 오류**
- 세 번째 항: 연속적인 은닉 상태 간의 **시간적 평활성**(temporal smoothness) 규제
- $$\lambda_1 = 0.45, \lambda_2 = 0.45, \lambda_3 = 0.1$$

#### 3. 상태 공간 모델

학습된 신경망으로부터 다음의 동적 상태 공간 모델을 정의합니다:[1]

$$z_t = \chi_\psi(z_{t-1}, x_{1:t-1}, u_{1:t-1}) + e_z^t$$

$$x_t = \phi_\theta(z_t) + e_x^t$$

여기서:
- $$e_z^t$$: 은닉 상태 예측 오류 (평균 0, 공분산 $$\Sigma_z$$)
- $$e_x^t$$: 센서 측정값 재구성 오류 (평균 0, 공분산 $$\Sigma_x$$)

두 오류 모두 다변량 가우시안 분포를 따른다고 가정하며, 공분산 행렬은 검증 데이터로부터 경험적으로 추정됩니다.

#### 4. 베이지안 필터링을 이용한 이상 탐지

검출 단계에서는 Unscented Kalman Filter(UKF)를 적용합니다:[1]

**예측 단계**:
- 시그마 포인트 생성 및 변환을 통해 은닉 상태 분포의 평균과 공분산 예측
- Julier 시그마 함수로 sigma points 선택: $$(\mathcal{X}, w, \bar{w}) = \text{Sigma}(z_{t-1}, \Sigma_{t-1})$$
- Encoder-Context-Transition 네트워크를 통해 예측된 상태 생성
- Unscented transform으로 예측 분포 계산:

$$\bar{z}_t = \sum_{i=1}^{2d+1} w_i^m \chi_\psi(\mathcal{X}_t^i)$$

$$\bar{\Sigma}_t = \sum_{i=1}^{2d+1} w_i^c (\chi_\psi(\mathcal{X}_t^i) - \bar{z}_t)(\chi_\psi(\mathcal{X}_t^i) - \bar{z}_t)^T + \Sigma_z$$

**업데이트 및 이상 탐지 단계**:
- 예측된 상태를 Decoder로 통과시켜 센서 측정값 분포 추정
- Mahalanobis 거리로 이상 스코어 계산:

$$\text{anomaly score} = (x_t - \bar{x}_t)^T \bar{\Sigma}_x^{-1} (x_t - \bar{x}_t)$$

이상 스코어가 높을수록 관측 측정값이 정상 동작 범위에서 벗어났을 가능성이 높습니다.

- 칼만 이득을 통해 후방 추정(posterior estimation) 업데이트:

$$K_t = \bar{\Sigma}_{xz,t} \bar{\Sigma}_x^{-1}$$

$$\hat{z}_t = \bar{z}_t + K_t (x_t - \bar{x}_t)$$

$$\Sigma_t = \bar{\Sigma}_t - K_t \bar{\Sigma}_x K_t^T$$

***

## 모델 구조 및 특성

### 아키텍처의 설계 철학

NSIBF의 핵심 설계는 **명시적인 두 단계 분리**입니다:[1]

1. **신경망을 통한 시스템 식별**: 비선형 CPS 동역학을 학습
2. **베이지안 필터링을 통한 불확실성 추적**: 센서 및 과정 노이즈를 명시적으로 모델링

이는 기존의 암묵적(implicit) 방법들과 다릅니다. 예를 들어, 많은 VAE 기반이나 정규화 흐름(normalizing flow) 기반 방법들은 신경망 안에 필터링 로직을 숨깁니다. NSIBF는 이를 분리함으로써:[1]

- 노이즈를 더 명시적으로 처리 가능
- 불확실성을 추적하는 메커니즘이 투명
- CPS에 고유한 과정 노이즈와 센서 노이즈를 분리하여 모델링

### 구성 요소별 역할

| 구성 요소 | 역할 | 특징 |
|---------|------|------|
| Encoder | 센서 측정값을 은닉 상태로 차원 축소 | 피드포워드 네트워크 |
| Context | 시간 맥락 인코딩 | LSTM 기반, 슬라이딩 윈도우 사용 |
| Transition | 상태 전이 학습 | 가장 중요한 동역학 모델링 서브네트 |
| Decoder | 은닉 상태를 센서 공간으로 재구성 | Encoder와 가중치 공유 |
| UKF | 불확실성 추적 및 이상 탐지 | 베이지안 필터링 |

### 하이퍼파라미터

실험에서 사용된 하이퍼파라미터:[1]

- **은닉 상태 차원**: 데이터셋별로 상이 (PUMP: 15, WADI: 36, SWAT: 36)
- **손실 함수 가중치**: $$\lambda_1=0.45, \lambda_2=0.45, \lambda_3=0.1$$
- **네트워크 깊이**: 1~3개의 숨겨진 계층
- **숨겨진 유닛 수**: 32~256
- **슬라이딩 윈도우**: 5~12 타임 스텝
- **훈련 에포크**: 100

***

## 성능 향상 분석

### 정성적 실험 (Synthetic CPS)

논문은 노이즈가 있는 사인파 시뮬레이션으로 NSIBF의 이점을 시연합니다:[1]

**실험 설정**:
- 정상 데이터: 10,000 타임 스텝
- 테스트 데이터: 10,000 타임 스텝 (매 1,000 스텝마다 100 스텝의 이상 주입)
- 과정 노이즈: $$\xi \sim \mathcal{N}(0, 0.1^2)$$
- 정상 측정 노이즈: $$\omega \sim \mathcal{N}(0, 0.2^2)$$
- 이상 측정 노이즈: $$\omega \sim \mathcal{N}(0, 0.6^2)$$

**결과**:
- **NSIBF-RECON** (재구성 오류만): ROC AUC가 낮음
- **NSIBF-PRED** (예측 오류만): ROC AUC가 낮음
- **NSIBF** (베이지안 필터링): 명확한 이상 탐지 성능

**핵심 발견**: 밀도 기반 방법이 잔차 오류 기반 방법보다 노이즈에 더 강건합니다.[1]

### 정량적 실험 (실제 CPS 데이터)

#### 1. 데이터셋

3개의 산업용 CPS 데이터셋:[1]

| 데이터셋 | 출처 | 특징 | 센서 | 액추에이터 | 훈련 크기 | 테스트 크기 | 이상율 |
|---------|------|------|------|---------|---------|---------|-------|
| PUMP | 지방 급수 시스템 | 5개월 간 분당 수집 | 44 | 0 | 76,901 | 143,401 | 10.05% |
| WADI | 도시 급수 테스트베드 | 16일, 초단위 수집 | 67 | 26 | 241,921 | 15,701 | 7.09% |
| SWAT | 수처리 시스템 | 11일, 초단위 수집 | 25 | 26 | 99,360 | 89,984 | 11.99% |

#### 2. 비교 대상 방법

7개의 최신 이상 탐지 방법과 비교:[1]

- **전통적 방법**: Isolation Forest (트리 기반)
- **재구성 오류 기반**: Sparse-AE, EncDec-AD (LSTM 인코더-디코더), USAD (적대적 학습)
- **예측 오류 기반**: LSTM-PRED
- **밀도 기반**: DAGMM (가우시안 혼합), OmniAnomaly (정규화 흐름)

#### 3. 평가 지표

포인트 조정 F1 스코어(point-adjusted F1)를 주요 평가 지표로 사용:[1]

- 연속된 이상 구간에서 어느 한 지점이라도 탐지되면 전체 구간으로 간주
- 모든 가능한 임계값에 대해 최고 F1 스코어 보고

#### 4. 실험 결과

| 방법 | PUMP F1 | WADI F1 | SWAT F1 | 평균 개선 |
|------|---------|---------|---------|---------|
| Isolation Forest | 0.729 | 0.798 | 0.850 | - |
| Sparse-AE | 0.767 | 0.770 | 0.799 | - |
| EncDec-AD | 0.565 | 0.708 | 0.748 | - |
| LSTM-Pred | 0.714 | 0.726 | 0.812 | - |
| DAGMM | 0.860 | 0.825 | 0.835 | - |
| OmniAnomaly | 0.886 | 0.869 | 0.854 | - |
| USAD | 0.732 | 0.841 | 0.846 | - |
| **NSIBF (제안)** | **0.912** | **0.901** | **0.919** | **+3.4%~7.6%** |

**성능 향상**:[1]

- PUMP: 0.912 vs 0.886 (OmniAnomaly) → **2.9% 향상**
- WADI: 0.901 vs 0.869 (OmniAnomaly) → **3.7% 향상**
- SWAT: 0.919 vs 0.854 (OmniAnomaly) → **7.6% 향상**

### 성능 향상의 근본 원인

1. **밀도 기반 방법의 우월성**: 상대적 오류 크기보다 관측값의 확률적 가능성을 평가[1]
   - 재구성/예측 오류가 노이즈에 의해 높아져도, 베이지안 필터링으로 불확실성 범위 내인지 판단 가능

2. **신경망의 비선형 모델링**: 복잡한 CPS 동역학을 유연하게 학습[1]

3. **명시적 노이즈 모델링**: 과정 노이즈 $$\Sigma_z$$와 센서 노이즈 $$\Sigma_x$$를 분리하여 각각 추정[1]

4. **시간적 맥락 활용**: LSTM 기반 Context 네트워크로 슬라이딩 윈도우의 시간 의존성 포착[1]

---

## 일반화 성능 향상 가능성

### 현재 강점

1. **데이터셋 간 일관된 성능**: 3개의 이질적인 CPS 데이터셋 모두에서 최고 성능 달성[1]

2. **하이퍼파라미터 튜닝 전략**: **균일 음성 샘플링**(uniform negative sampling)을 이용한 하이퍼파라미터 최적화[1]
   - 실제로 이상 라벨이 없는 상황을 시뮬레이션하여 검증 데이터에서 인공 이상 생성
   - 이를 통해 실무에서 직면하는 "이상 데이터 부족" 문제 완화

3. **점-조정 메트릭 활용**: 개별 포인트 오분류보다 연속 구간 탐지 성공 여부로 평가하여 더 실용적[1]

### 일반화 성능 향상을 위한 제안 및 고려사항

#### 1. 모델 아키텍처 개선

**현재 한계:**
- Encoder/Decoder가 선형 피드포워드 네트워크로, 비선형성이 제한적[1]

**개선 방안:**
- **Attention 메커니즘 추가**: Encoder/Decoder에 self-attention 층 도입하여 센서 간 상관관계를 동적으로 학습
- **Multi-scale 특성**: 다양한 시간 스케일의 특성 동시 학습
- **잔차 연결**: 깊은 네트워크에서 그래디언트 흐름 개선

#### 2. 노이즈 적응성 강화

**현재 한계:**
- 공분산 행렬 $$\Sigma_z, \Sigma_x$$가 학습 데이터에서 고정[1]

**개선 방안:**
- **동적 노이즈 모델링**: 시간이나 시스템 상태에 따라 변하는 노이즈를 모델링
  - 예: 시간 의존적 공분산 $$\Sigma_x^t$$
- **적응형 필터링**: 관측 신뢰도를 동적으로 조정하여 시간 변화하는 센서 품질 대응

#### 3. 도메인 외 일반화 (Out-of-Distribution Generalization)

**현재 한계:**
- 훈련 데이터와 다른 동작 조건(예: 새로운 제어 신호 범위)에서 성능 저하 가능[1]

**개선 방안:**
- **메타 러닝(Meta-learning)**: 다양한 CPS 데이터를 통해 빠른 적응 가능하도록 학습
- **도메인 적응**: 소량의 목표 CPS 데이터로 상태 공간 모델을 재보정
- **불확실성 추정 강화**: Bayesian neural networks나 ensemble 방법으로 모델 불확실성 직접 측정

#### 4. 데이터 효율성

**현재 한계:**
- 훈련에 다량의 정상 데이터 필요[1]

**개선 방안:**
- **자기지도 학습(Self-supervised learning)**: 레이블 없이 시간 예측 등으로 사전 학습
- **전이 학습**: 유사한 CPS 데이터에서 사전 학습된 Encoder/Transition 네트워크 활용
- **소수 샷 학습(Few-shot learning)**: 제한된 정상 데이터로도 학습 가능하도록 개선

#### 5. 시퀀스 레벨 탐지 강화

**현재 방법:**
- 논문에서 기술적으로 가능하지만, 주로 포인트 레벨 탐지에 초점[1]

**개선 방안:**
- **시간 세그멘테이션**: 비터비 알고리즘(Viterbi algorithm) 등으로 이상 구간의 시작/종료 경계 정확하게 탐지
- **다중 레벨 표현**: 서로 다른 시간 해상도에서의 특성 학습

#### 6. 검증 및 평가 개선

**현재 한계:**
- 균일 음성 샘플링이 실제 이상 분포를 완전히 반영하지 못할 수 있음[1]

**개선 방안:**
- **음이 아닌 대조 학습**(negative contrastive learning): 실제 정상 데이터와 합성 이상 데이터 간 대비 학습
- **테스트 시간 적응**: 테스트 단계에서 소량의 레이블된 이상으로 모델 미세 조정

***

## 한계 및 제약사항

### 1. 계산 복잡도[1]

- **문제**: UKF의 sigma point 생성 및 변환 계산이 은닉 상태 차원에 따라 기하급수적으로 증가 ($$2d+1$$개 sigma points)
- **영향**: 고차원 시스템에서 실시간 처리 어려움
- **가능한 해결책**: 축소된 UKF나 입자 필터(particle filter) 고려

### 2. 선형 복원 가정[1]

- **문제**: Decoder가 선형 피드포워드 네트워크로, 비선형 재구성 제한
- **영향**: 센서 측정값과 은닉 상태 간 복잡한 비선형 관계 포착 어려움

### 3. 가우시안 가정[1]

- **문제**: 예측 오류와 재구성 오류가 다변량 가우시안을 따른다고 가정
- **영향**: 오염된 데이터(corrupted outliers)나 다중 모드 분포에서 성능 저하 가능

### 4. 임계값 설정[1]

- **문제**: 이상 점수를 이상으로 판정하는 임계값을 수동으로 설정 필요
- **영향**: 실무에서 허용 가능한 오경보율(false alarm rate)에 따라 시간에 따라 달라져야 함

### 5. 제어 입력 의존성[1]

- **문제**: 액추에이터 상태 $$u_t$$가 필요하지만, 보안상 이유로 접근 불가능한 경우 많음
- **영향**: 완전한 시스템 관찰가능성(observability) 확보 어려움

### 6. 개념적 표류(Concept Drift)[1]

- **문제**: 시스템이 시간에 따라 성능 열화(예: 부품 마모)할 때, 학습된 모델의 성능 저하
- **영향**: 주기적인 재학습 또는 온라인 학습 전략 필요

***

## 연구 영향과 향후 고려사항

### 학문적 영향

1. **신경망과 전통 제어 이론의 통합**: NSIBF는 딥러닝과 칼만 필터 같은 고전적 신호 처리 기법의 효과적인 결합 사례를 제시하여, 물리 기반 딥러닝(physics-informed deep learning) 연구 방향 강화[1]

2. **밀도 기반 이상 탐지의 재조명**: 시계열 이상 탐지에서 재구성 오류만으로는 부족함을 실증적으로 보여주어, 불확실성 정량화의 중요성 재강조[1]

3. **CPS 안보 연구 활성화**: 산업용 제어 시스템의 사이버 공격 탐지에 새로운 벤치마크와 방법론 제시[1]

### 실무적 영향

1. **산업 응용성**: PUMP, WADI, SWAT 등 실제 산업 시스템 데이터에서의 우수 성능으로 실제 배포 가능성 제시[1]

2. **코드 공개**: GitHub에서 구현을 공개하여 실무자의 쉬운 도입 가능[1]

3. **스케일 가능성**: 67개 센서를 가진 WADI 데이터셋에서도 효과적이어서, 중규모 산업 시스템 대응 가능성 보임[1]

### 향후 연구 시 고려사항

#### 1. 교차 도메인 적응

**방향**: 다양한 산업 영역(수처리, 에너지, 제조 등)의 데이터로 사전 학습하여, 새로운 CPS에 신속한 적응

**기대 효과**: 소량의 정상 데이터만으로도 신뢰할 수 있는 이상 탐지 가능

#### 2. 온라인 학습 및 적응

**방향**: 배포 후 현장 데이터로 모델을 지속적으로 업데이트하는 메커니즘 개발

**기대 효과**: 센서 드리프트나 장비 노화에 대응

#### 3. 해석 가능성 강화

**방향**: 어떤 센서/특성이 이상 탐지에 기여했는지 설명하는 해석 모듈 추가

**기대 효과**: 도메인 전문가가 탐지 결과를 이해하고 신뢰하기 용이

#### 4. 협력적 이상 탐지

**방향**: 여러 연관된 CPS(예: 스마트 그리드의 여러 변전소) 간 정보 공유를 통한 분산 이상 탐지

**기대 효과**: 개별 시스템 단독으로는 탐지 어려운 광역 이상 감지

#### 5. 실시간성 개선

**방향**: 에지 컴퓨팅(edge computing) 환경 대응, 경량화된 모델 개발

**기대 효과**: 지연 없는 즉각적 이상 알람 및 자동 대응

#### 6. 비정상 데이터 활용 전략

**방향**: 다양한 유형의 비정상(예: 점진적 편향, 갑작스러운 충격, 진동 이상)을 분류하는 프레임워크

**기대 효과**: 단순 탐지를 넘어 근본 원인 분석 및 예측 유지보수로 확대

***

## 결론

**"Time Series Anomaly Detection for Cyber-physical Systems via Neural System Identification and Bayesian Filtering"** 논문은 신경망의 표현력과 베이지안 필터링의 강건성을 결합하여 산업용 CPS의 이상 탐지 문제를 효과적으로 해결한 중요한 기여를 제시합니다.[1]

**핵심 혁신**: 명시적으로 시스템 식별과 필터링을 분리함으로써, 센서 노이즈가 많은 현실적 CPS 환경에서도 신뢰할 수 있는 이상 탐지가 가능함을 입증했습니다.[1]

**제한점 인식**: 계산 복잡도, 가우시안 가정, 임계값 설정 등의 한계를 인식하면서도, 이들을 극복하기 위한 여러 개선 방향을 제시했습니다.[1]

**향후 방향**: 적응형 노이즈 모델링, 도메인 외 일반화, 온라인 학습, 해석 가능성 강화 등을 통해 더욱 견고하고 실용적인 이상 탐지 시스템 구축이 가능할 것으로 예상됩니다.[1]

이 논문이 제시한 신경망-베이지안 필터링 하이브리드 접근법은 시계열 이상 탐지뿐 아니라, 다른 불확실성이 높은 시계열 작업(예측, 이상 원인 진단, 예측 유지보수)에도 적용 가능한 일반화된 프레임워크로서 앞으로의 AI 기반 산업 안보 및 운영 최적화 연구에 중요한 기초를 제공할 것입니다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/4be4d763-299e-4890-918d-343f10702e7f/2106.07992v2.pdf)
