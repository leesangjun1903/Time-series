# TFAD: A Decomposition Time Series Anomaly Detection Architecture with Time-Frequency Analysis

## 1. 핵심 주장과 주요 기여

TFAD(Time-Frequency Analysis based Anomaly Detection) 논문은 시계열 이상 탐지 분야에서 시간 영역과 주파수 영역을 동시에 활용하는 새로운 접근법을 제시합니다. 논문의 핵심 주장은 기존 방법들이 시간 영역 분석에만 집중하여 주파수 영역의 중요한 정보를 활용하지 못했다는 점입니다.[1]

**주요 기여:**

- **이중 분기 아키텍처**: 시간 영역 분석 브랜치와 주파수 영역 분석 브랜치를 통합하여 다양한 유형의 이상을 효과적으로 탐지합니다.[1]

- **시계열 분해 통합**: Hodrick-Prescott(HP) 필터를 사용한 시계열 분해를 통해 추세와 잔차 성분을 분리하여 각각 독립적으로 분석함으로써 단순한 TCN(Temporal Convolutional Network) 구조로도 우수한 성능을 달성합니다.[1]

- **포괄적 데이터 증강**: 정상 데이터 증강, 이상 데이터 증강, 시간 영역 증강, 주파수 영역 증강을 모두 구현하여 레이블 데이터 부족 문제를 해결합니다.[1]

- **최고 수준의 성능**: Yahoo, KPI, SMAP, MSL 등 벤치마크 데이터셋에서 단변량 및 다변량 시계열 이상 탐지 모두에서 state-of-the-art 성능을 달성했습니다.[1]

## 2. 상세 분석: 문제, 방법, 모델 구조, 성능 및 한계

### 2.1 해결하고자 하는 문제

논문은 시계열 이상 탐지에서 세 가지 주요 문제를 다룹니다:[1]

**1) 복잡한 시간적 의존성**: 시계열에서 점이나 부분 시퀀스는 컨텍스트와 비교했을 때 이상으로 간주되며, 전역 점 이상(global point anomaly), 계절성 이상(seasonality anomaly), 셰이플릿 이상(shapelet anomaly) 등 다양한 유형이 존재합니다.[1]

**2) 제한된 레이블 데이터**: 이상은 드물게 발생하며, 데이터 기반 모델을 학습하기 위한 레이블 데이터가 부족합니다.[1]

**3) 단일 영역 분석의 한계**: 기존 방법들은 주로 시간 영역에만 집중하여 주파수 영역의 정보를 충분히 활용하지 못했습니다. 시간 영역은 점 이상 탐지에는 효과적이지만 패턴 이상(계절성 이상 등) 탐지에는 어려움이 있습니다.[1]

### 2.2 제안하는 방법 (수식 포함)

#### 불확실성 원리 기반 동기

논문은 시간-주파수 분석의 불확실성 원리를 이론적 근거로 제시합니다. 신호 $$s(t)$$와 그 푸리에 변환 $$S(\omega)$$에 대해:[1]

$$S(\omega) = \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\infty} s(t)e^{-j\omega t}dt$$[1]

시간과 주파수 밀도 함수의 표준편차 $$\sigma_t$$와 $$\sigma_\omega$$는 다음 관계를 만족합니다:

$$\sigma_t^2 \sigma_\omega^2 \geq \frac{1}{4} + \text{Cov}_{t\omega}^2$$[1]

이는 한 구조가 시간 영역에서 점 이상을 잘 탐지하면 주파수 영역에서는 탐지 능력이 떨어지며, 그 반대도 마찬가지임을 의미합니다.[1]

#### 시계열 분해

HP 필터를 사용하여 시계열 $$y_t$$를 추세 $$\tau_t$$와 잔차 $$\epsilon_t$$로 분해합니다:

$$y_t = \tau_t + \epsilon_t$$[1]

추세 성분은 다음 최소화 문제를 풀어 얻습니다:

```math
\min_\tau \left\{ \sum_{t=1}^{T} (y_t - \tau_t)^2 + \lambda \sum_{t=2}^{T-1} [(\tau_{t+1} - \tau_t) - (\tau_t - \tau_{t-1})]^2 \right\}
```

[1]

여기서 $$\lambda$$는 추세의 변동에 대한 민감도를 조절하는 매개변수입니다.[1]

#### 윈도우 분할

전체 윈도우(full window)와 컨텍스트 윈도우(context window)를 설정하여 의심 시퀀스(suspect window)의 이상을 탐지합니다. 전체 윈도우 = 컨텍스트 윈도우 + 의심 윈도우 구조로 구성됩니다.[1]

#### 주파수 변환

이산 푸리에 변환(DFT)을 통해 시간 영역을 주파수 영역으로 변환합니다:

$$X_k = \sum_{n=0}^{N-1} x_n \cdot e^{-i\frac{2\pi}{N}kn} = \sum_{n=0}^{N-1} x_n \cdot \left[ \cos\left(\frac{2\pi}{N}kn\right) - i \cdot \sin\left(\frac{2\pi}{N}kn\right) \right]$$[1]

실수부(Re)와 허수부(Im)를 교차 배치하여 $$\{X_k\} = \{Re_1, Im_1, Re_2, Im_2, ..., Re_n, Im_n\}$$ 형태로 구성합니다.[1]

#### 이상 점수 계산

코사인 유사도를 사용하여 이상 점수(AS)를 계산합니다:

$$AS = \mathcal{F}\{dis(RV_{tre}^T, RV_{res}^T, RV_{tre}^F, RV_{res}^F)\}$$[1]

여기서 $$RV_{tre}^T, RV_{res}^T$$는 시간 영역의 추세 및 잔차 성분의 표현 결과이고, $$RV_{tre}^F, RV_{res}^F$$는 주파수 영역의 표현 결과입니다.[1]

### 2.3 모델 구조

TFAD의 전체 구조는 다음과 같이 구성됩니다:[1]

**1) 데이터 증강 모듈**:
- **정상 데이터 증강**: Robust STL을 사용해 저잡음 데이터 생성, 주파수 영역에서 실수부와 허수부를 소폭 변경하여 다양한 정상 데이터 생성[1]
- **이상 데이터 증강**: 시간 영역에서 점 스케일 수정(점 이상용), 점/짧은 시퀀스 교환 및 믹스업(컨텍스트 이상용), 주파수 영역 증강(계절성 및 복잡한 이상용)[1]

**2) 분해 모듈**: HP 필터를 통한 추세-잔차 분해[1]

**3) 윈도우 분할 모듈**: 슬라이딩 윈도우 방식으로 전체/컨텍스트/의심 윈도우 생성[1]

**4) 시간 및 주파수 브랜치**:
- 시간 브랜치: 추세와 잔차 성분에 대해 TCN으로 표현 학습[1]
- 주파수 브랜치: DFT 후 TCN으로 표현 학습[1]

**5) 이상 점수 모듈**: 전체 윈도우와 컨텍스트 윈도우 간 코사인 유사도 비교, 투표 전략으로 각 시점의 이상 여부 결정[1]

### 2.4 성능 향상

**정량적 성과**:

- **단변량 시계열** (Yahoo/KPI 데이터셋):[1]
  - Yahoo (비지도): F1 점수 81.13±0.52 (NCAD와 동등, 분산은 크게 낮음)
  - KPI (비지도): F1 점수 79.80±0.74 (기존 최고 대비 3% 향상)
  - KPI (지도): F1 점수 82.10±0.42 (기존 최고 대비 2.9% 향상, 분산 크게 감소)

- **다변량 시계열** (SMAP/MSL 데이터셋):[1]
  - SMAP: F1 점수 96.32±1.57 (NCAD 94.45 대비 1.87% 향상)
  - MSL: F1 점수 96.41±0.34 (NCAD 95.60 대비 0.81% 향상, 분산 크게 감소)

**Ablation Study 결과** (KPI 지도 학습 설정):[1]
- 기본 TCN만: F1 50.31
- TCN + 분해: F1 66.97 (+30% 향상)
- TCN + 분해 + 정상 증강: F1 67.10
- TCN + 분해 + 정상 증강 + 시간 이상 증강: F1 74.93 (+승수 효과)
- 완전한 TFAD (주파수 브랜치 포함): F1 82.06 (분산도 크게 감소)

**핵심 성능 향상 요인**:

1. **시간-주파수 이중 분석**: 점 이상은 시간 영역에서, 패턴 이상(계절성 등)은 주파수 영역에서 효과적으로 탐지[1]
2. **분해 효과**: 추세와 잔차를 독립적으로 분석하여 각 성분의 이상을 명확히 구분[1]
3. **데이터 증강 시너지**: 정상/이상, 시간/주파수 증강의 조합이 승수 효과 발생[1]

### 2.5 한계

논문에서 명시적으로 언급된 한계점들:[1]

**1) 적응형 윈도우 크기 문제**: 인접한 여러 이상 영역이 있을 때, 더 명확한 이상이 덜 명확한 이상을 은폐할 수 있습니다. 의심 윈도우가 테스트될 때 중간 부분의 이상이 전체 윈도우와 컨텍스트 윈도우의 표현을 크게 변경하여 우측 끝 부분의 이상을 감춤.[1]

**2) 다변량 분해 방법**: 다변량 시계열에 대해 각 시계열을 개별적으로 분해하는데, 이는 최선의 방법이 아닐 수 있습니다.[1]

**3) 메트릭 평가의 제한**: Point-adjusted F1 점수만을 사용했으며, 다른 F1 유형 메트릭(첫 경보 중요도, 경보 비율 등)에 대한 평가는 향후 과제로 남겨두었습니다.[1]

**4) Transformer의 제한적 성능**: 윈도우 분할로 인해 윈도우 길이가 짧아져 Transformer는 TCN보다 낮은 성능(F1 0.59 vs 0.75)을 보였습니다. Transformer는 긴 시계열에 적합하지만, 짧은 윈도우에서는 TCN이 지역 정보를 더 잘 모델링합니다.[1]

## 3. 일반화 성능 향상 가능성

### 3.1 강력한 일반화 능력의 증거

**분산(Variance) 감소**: TFAD는 NCAD에 비해 대부분의 경우 현저히 낮은 분산을 보입니다. 이는 모델이 더 안정적이고 실제 시스템에서 강건하다는 것을 의미합니다.[1]

- Yahoo: TFAD 0.52 vs NCAD 1.43
- KPI(비지도): TFAD 0.74 vs NCAD 0.89
- KPI(지도): TFAD 0.42 vs NCAD 0.92
- MSL: TFAD 0.34 vs NCAD 0.59

**강건성 향상 메커니즘**:

1. **다양한 데이터 증강**: 정상 데이터와 이상 데이터 모두에 대한 증강, 특히 이상 데이터 증강은 데이터셋의 실제 이상과 동일할 필요가 없으며, 다양한 증강 이상이 모델의 강건성에 기여합니다.[1]

2. **이중 영역 분석의 보완 효과**: 주파수 브랜치 추가 후 F1 점수뿐만 아니라 분산도 감소했습니다. 시간 영역 브랜치만으로는 일부 시퀀스 이상을 탐지하기 어렵고 과적합이 발생할 수 있지만, 주파수 브랜치가 이를 보완합니다.[1]

### 3.2 특수 이상 패턴에 대한 적응성

SMAP 데이터셋의 첫 번째 차원에 나타나는 느린 기울기(slow slope) 패턴에 대한 사례 연구에서, 특수 이상 데이터 증강(slow-slop injection)을 통해 큰 성능 향상을 달성했습니다:[1]

- 기본 TFAD: F1 90.32
- 특수 증강 TFAD: F1 96.09 (+5.77%p, Recall 98.36%)

이는 사전 정보가 있을 때 TFAD가 특정 도메인에 쉽게 적응할 수 있음을 보여줍니다.[1]

### 3.3 단순한 아키텍처의 장점

복잡한 신경망 구조를 구현하지 않았음에도 불구하고 기존 딥러닝 모델보다 나은 성능을 달성했습니다. 이는:[1]

- **해석 가능성**: 추세와 잔차 성분별 이상 점수를 통해 어느 성분에서 이상이 발생했는지 설명 가능
- **구현 용이성**: 단순한 TCN 구조로 낮은 메모리 사용
- **과적합 위험 감소**: 복잡한 구조보다 일반화 가능성 높음

### 3.4 일반화 성능 개선 방향

논문에서 제시하지 않았지만, 추가적인 일반화 향상을 위해 고려할 수 있는 방향:

1. **적응형 윈도우 크기**: 데이터 특성에 따라 동적으로 윈도우 크기를 조정하면 다양한 패턴의 이상을 더 효과적으로 탐지 가능
2. **다변량 시계열 특화 분해**: 변수 간 의존성을 고려한 분해 방법 개발
3. **온라인 학습 메커니즘**: 실시간으로 새로운 패턴에 적응하는 기능 추가
4. **도메인 적응**: Transfer learning을 통해 한 도메인에서 학습한 모델을 다른 도메인에 적용

## 4. 연구 영향과 향후 연구 고려사항

### 4.1 학계 및 산업계에 미치는 영향

**시계열 이상 탐지의 새로운 패러다임**: TFAD는 시간 영역 분석에만 집중하던 기존 접근에서 벗어나 시간-주파수 통합 분석의 중요성을 입증했습니다. 이는 향후 연구자들이 다중 영역 분석을 고려하도록 유도할 것입니다.[1]

**실용적 가치**: 
- 단순한 구조로 높은 성능 달성: 실제 시스템 배포에 유리
- 낮은 메모리 사용: IoT 및 엣지 디바이스 적용 가능
- 해석 가능성: 금융, 의료 등 설명이 필요한 도메인에 적합

**연구 방향의 확장**:
- 다른 시계열 작업(예측, 분류)에 시간-주파수 분석 적용
- 주파수 영역 데이터 증강 기법의 확장 연구
- 분해 기반 접근법의 발전

### 4.2 향후 연구 시 고려할 점

**1) 이론적 확장**:
- 다양한 주파수 변환 방법(Wavelet, STFT 등)의 비교 연구
- 불확실성 원리의 심화 분석 및 최적 균형점 탐색
- 다변량 시계열에 대한 이론적 프레임워크 개발

**2) 방법론 개선**:
- **적응형 메커니즘**: 윈도우 크기, 분해 파라미터, 증강 비율의 자동 조정
- **주의(Attention) 메커니즘**: 시간-주파수 표현을 효과적으로 융합
- **멀티스케일 분석**: 다양한 시간 스케일의 이상 탐지

**3) 평가 및 벤치마킹**:
- 다양한 F1 메트릭 적용 및 비교
- 더 많은 실세계 데이터셋에서 검증
- 온라인 이상 탐지 시나리오에서의 성능 평가

**4) 확장 응용**:
- **도메인 특화 설계**: 의료, 금융, 제조 등 특정 도메인의 특성을 고려한 커스터마이징
- **실시간 시스템**: 스트리밍 데이터에 대한 온라인 버전 개발
- **설명 가능 AI**: 이상 발생 원인에 대한 더 상세한 해석 제공
- **연합 학습**: 프라이버시 보호가 필요한 환경에서의 활용

**5) 실무 적용 고려사항**:
- 계산 효율성 최적화: 대규모 시스템에서의 확장성
- 하이퍼파라미터 민감도 분석: 다양한 데이터셋에 대한 튜닝 가이드라인
- 오탐(False Positive) 감소 전략: 실제 운영 환경에서 중요한 요소
- 인간-AI 협업 인터페이스: 도메인 전문가의 피드백 통합

TFAD는 시계열 이상 탐지 분야에 중요한 기여를 했으며, 시간-주파수 분석의 가치를 실증했습니다. 향후 연구는 이론적 깊이를 더하고, 실무 적용을 확대하며, 새로운 응용 분야로 확장하는 방향으로 진행될 것으로 기대됩니다.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/8b574a61-5181-4e0a-b074-d841b912af81/2210.09693v2.pdf)
