# Multivariate Time Series Anomaly Detection and Interpretation using Hierarchical Inter-Metric and Temporal Embedding

### 1. 핵심 주장 및 주요 기여

InterFusion은 다변량 시계열(Multivariate Time Series, MTS)에서 **inter-metric(지표 간) 의존성**과 **temporal(시간적) 의존성**을 동시에 모델링하는 최초의 비지도 학습 이상탐지 알고리즘입니다. 논문의 핵심 기여는 다음과 같습니다.[1]

**계층적 변분 오토인코더(HVAE)를 활용한 이중 임베딩**: 두 개의 확률적 잠재 변수를 통해 저차원 inter-metric 임베딩과 temporal 임베딩을 명시적으로 학습합니다. 이는 MTS의 정상 패턴을 더욱 정교하게 포착할 수 있게 합니다.[1]

**세 가지 핵심 설계**: (1) **계층적 구조(Hierarchical Structure)**로 temporal 정보를 고려한 inter-metric 임베딩 학습, (2) **두 방향 임베딩(Two-view Embedding)**으로 시간 및 지표 차원에서 MTS 압축, (3) **사전필터링 전략(Prefiltering Strategy)**으로 훈련 데이터의 잠재적 이상치에 대한 과적합 방지.[1]

**MCMC 기반 이상 해석 방법**: 검출된 이상치에서 가장 이상한 지표들을 식별하기 위해 MCMC imputation을 반복적으로 적용하여, 이상치가 임베딩에 미치는 편향을 제거하고 정상 패턴을 근사합니다.[1]

**우수한 성능**: 4개 실제 데이터셋(SWaT, WADI, SMD, ASD)에서 평균 F1-Score 0.94 이상, 해석 정확도 0.87을 달성하여 기존 최고 성능 방법들을 크게 능가했습니다.[1]

### 2. 문제 정의, 제안 방법, 모델 구조 및 성능

#### 2.1 해결하고자 하는 문제

다변량 시계열은 복잡한 시스템(제조 시스템, IT 서비스 등)의 상태를 모니터링하는 여러 지표로 구성됩니다. 기존 방법들은 다음과 같은 한계를 가집니다:[1]

- **단일 의존성 모델링**: 대부분의 기존 방법은 temporal 의존성 또는 inter-metric 의존성 중 하나만 주로 모델링합니다. LSTM-NDT, MSCRED는 temporal 의존성에, MAD-GAN, OmniAnomaly, USAD는 inter-metric 의존성에 집중합니다.[1]
- **이상 해석의 부정확성**: 기존 방법들은 원시 재구성 점수를 직접 사용하여 이상치를 해석하지만, 이상치가 모든 차원의 재구성에 영향을 미쳐 오해석을 유발합니다.[1]
- **훈련 데이터의 이상치**: 실제 데이터에는 훈련 중에도 이상치가 포함될 수 있어, 이에 대한 과적합 위험이 있습니다.[1]

#### 2.2 제안 방법 (수식 포함)

**생성 모델 분해**

InterFusion의 생성 모델은 다음과 같이 분해됩니다:[1]

$$p(x, z_1, z_2) = p(x|z_1, z_2)p(z_1|z_2)p(z_2)$$

여기서 $$z_1$$과 $$z_2$$는 각각 inter-metric과 temporal 임베딩을 학습하는 확률적 잠재 변수입니다.

**변분 사후분포**

변분 사후분포는 다음과 같이 분해됩니다:[1]

$$q(z_1, z_2|x) = q(z_1|z_2)q(z_2|x)$$

각 시간 $$t$$에서: $$q(z_{1t}|z_{1,t-1}, a_t) = h(a_{t-1}, d_t)$$

여기서 $$a_t$$는 역방향 순환 GRU 네트워크로부터 유도된 결정론적 상태입니다.[1]

**ELBO 학습 목적함수**

보조 결정론적 변수 $$d, e$$를 고려한 훈련 목적함수는:[1]

$$\mathcal{L}(x,\theta,\phi) = \mathbb{E}_{q(z_1,z_2,d|x)}\left[\log p(x|z_1, z_2, e)\right] - D_{KL}(q(z_1, z_2, d|x)||p(z_1, z_2, e))$$

이를 전개하면:[1]

$$\mathbb{E}_q\left[\log p(x|z_1, z_2, e) + \log p(z_1, e|z_2) + \log p(z_2) - \log q(z_1, d|z_2, x) - \log q(z_2|x)\right]$$

시간 차원을 고려한 로그 확률 계산:[1]

$$\log p(z_1, e|z_2) - \log q(z_1, d|z_2, x) = \sum_{t=1}^{W}\left[\log p(z_{1t}|z_{1,t-1}, e_t) - \log q(z_{1t}|z_{1,t-1}, a_t)\right]$$

**이상 점수 계산**

온라인 탐지 시, 재구성 확률을 이상 점수로 사용합니다:[1]

$$\mathbb{E}_{q(z_1,z_2|x)}[-\log p(x|z_1, z_2)]$$

MCMC imputation 후 수정된 재구성 확률:[1]

$$\mathbb{E}_{q(z_1,z_2|x')}[\log p(x|z_1, z_2)] \approx \frac{1}{L}\sum_{l=1}^{L}\log p(x|z_1^l, z_2^l)$$

여기서 $$z_1^l, z_2^l$$은 $$q(z_1, z_2|x')$$에서 샘플링됩니다.

#### 2.3 모델 구조

**계층적 구조**: $$z_2$$ (temporal 임베딩)를 먼저 학습하고, $$z_1$$ (inter-metric 임베딩)이 $$z_2$$에 조건부로 의존하도록 하여, inter-metric 임베딩이 temporal 정보를 인식하도록 합니다.[1]

**두 방향 임베딩**: 
- **Temporal 임베딩**: Conv1D 레이어를 시간 차원에 적용하여 $$z_2 = f(x_{1:W}) \in \mathbb{R}^{M' \times W'}$$ 생성[1]
- **보조 재구성**: Deconv1D로 $$d_{1:W} = \psi(z_2) \in \mathbb{R}^{M \times W}$$ 생성[1]
- **Inter-metric 임베딩**: $$d$$의 지표 차원에서 SRNN 구조로 $$z_1 \in \mathbb{R}^{M' \times W'}$$ 유도[1]

**사전필터링 전략**: $$z_1$$을 원시 입력 $$x$$가 아닌 재구성된 입력 $$d$$로부터 유도하여, temporal 이상치가 필터링된 상태에서 inter-metric 임베딩을 학습합니다. $$d$$는 사전훈련된 VAE로 초기 재구성 능력을 보장합니다.[1]

**MCMC 기반 해석**: 검출된 이상치 $$x_t$$에 대해, 이상 부분 $$x_m$$을 추정하고 MCMC imputation을 반복하여 정상 패턴을 근사합니다. 알고리즘은 재구성 확률이 정상 기준선 $$b$$에 도달할 때까지 반복합니다.[1]

#### 2.4 성능 향상

**이상탐지 성능**: InterFusion은 4개 데이터셋에서 평균 F1-Score 0.9433을 달성하여, 최고 성능 기준 방법인 DSANet(0.9008)보다 4.7% 향상되었습니다. 특히 복잡한 데이터셋(WADI, ASD)에서 기존 방법들을 3.6~54.7% 상회했습니다.[1]

**이상 유형별 성능**: ASD 데이터셋에서 세 가지 이상 유형(inter-metric, temporal, inter-metric-temporal)에 대해 모두 F1-Score 0.95 이상의 재현율 0.98 이상을 달성했습니다.[1]

**해석 성능**: MCMC 기반 해석 방법을 통해 IPS(Interpretation Score) 0.8724를 달성하여, 기존 최고 방법인 OmniAnomaly(0.8019)를 8.8% 능가했습니다.[1]

**실시간 처리**: 오프라인 훈련은 약 6분, 온라인 탐지는 포인트당 1초 미만, 해석은 2-15초로 실시간 모니터링이 가능합니다.[1]

#### 2.5 한계

**분포 변화에 대한 민감성**: 논문은 안정적인 시스템을 가정하며, 큰 서비스 변화 시 재훈련이 필요합니다. 훈련 및 테스트 데이터가 동일한 분포를 따른다고 가정합니다.[1]

**계산 복잡도**: MCMC imputation은 각 검출된 이상치마다 반복적인 샘플링이 필요하여, 대규모 시스템에서는 계산 비용이 증가할 수 있습니다.

**하이퍼파라미터 민감성**: 슬라이딩 윈도우 길이($$W$$), 잠재 차원($$M'$$), MCMC 반복 횟수 등의 하이퍼파라미터 설정이 성능에 영향을 미칩니다. 다만 논문은 이러한 파라미터에 대해 비교적 둔감하다고 보고합니다.[1]

**해석 평가의 한계**: 제안된 IPS 메트릭은 segment-level 평가를 수행하지만, 실제 운영자의 주관적 평가와 완전히 일치하지 않을 수 있습니다.

### 3. 일반화 성능 향상 관련 내용

**사전필터링 전략을 통한 강건성**: 훈련 데이터에 이상치가 포함된 경우에도 과적합을 방지합니다. Ablation study에서 InterFusion-x(사전필터링 미적용)는 SMD, ASD에서 성능이 저하되었으나, 이상치가 없는 SWaT, WADI에서는 유사한 성능을 보였습니다.[1]

**계층적 구조의 정보 공유**: 독립적인 임베딩 학습 대신 계층적 구조를 사용하여, temporal 정보가 inter-metric 임베딩에 자연스럽게 통합되어 일반화 성능이 향상됩니다.[1]

**적은 훈련 데이터로도 효과적**: 1주일의 훈련 데이터만으로도 높은 성능을 달성할 수 있어, 데이터가 부족한 환경에서도 적용 가능합니다. 이는 모니터링 지표의 주기적 패턴을 효과적으로 학습하기 때문입니다.[1]

**다양한 도메인에서의 검증**: 물 처리 시설(SWaT, WADI), 서버 모니터링(SMD, ASD) 등 서로 다른 산업 도메인에서 일관되게 높은 성능을 보여 일반화 능력을 입증했습니다.[1]

**오토인코더 구조로의 확장성**: IF-AERNN 변형 실험에서, 제안된 세 가지 설계를 오토인코더 구조에 적용해도 Pure AE보다 크게 우수한 성능을 보여 설계의 일반화 가능성을 확인했습니다.[1]

### 4. 향후 연구에 미치는 영향 및 고려사항

**MTS 이상탐지 연구의 새로운 방향**: Inter-metric과 temporal 의존성을 동시에 명시적으로 모델링하는 접근법의 중요성을 확립했습니다. 향후 연구는 단일 의존성이 아닌 다중 의존성 학습에 초점을 맞춰야 합니다.[1]

**해석 가능성의 중요성**: MCMC 기반 해석 방법은 이상탐지에서 검출뿐만 아니라 해석의 중요성을 강조합니다. 실제 운영 환경에서는 "왜 이상인가"를 설명하는 것이 신뢰성과 실용성 향상에 필수적입니다.[1]

**계층적 표현 학습**: 계층적 변분 모델의 효과를 시계열 도메인에서 입증하여, 향후 다양한 시계열 작업(예측, 분류 등)에도 유사한 구조를 적용할 가능성을 제시합니다.

**실시간 시스템 배포 가능성**: 실제 대규모 인터넷 기업의 서버 모니터링 데이터에서 실현 가능성을 검증하여, 학술 연구를 산업 응용으로 연결하는 사례를 제공합니다.[1]

**향후 연구 고려사항**:

- **동적 환경 적응**: 서비스 변화, 개념 표류(concept drift) 상황에서 자동 재훈련 또는 온라인 학습 메커니즘 개발이 필요합니다.[1]
- **더 복잡한 의존성 모델링**: 그래프 구조나 주의(attention) 메커니즘을 통합하여 지표 간 복잡한 관계를 더욱 정교하게 포착할 수 있습니다.
- **다중 해상도 분석**: 다양한 시간 스케일에서 이상을 탐지하는 멀티스케일 접근법 연구가 필요합니다.
- **준지도/약지도 학습**: 소량의 레이블 데이터를 활용하여 성능을 더욱 향상시킬 수 있는 방법론 개발이 유망합니다.
- **계산 효율성**: MCMC imputation의 계산 비용을 줄이기 위한 근사 기법이나 경량화 방법 연구가 필요합니다.

InterFusion은 다변량 시계열 이상탐지 분야에서 이론적 깊이와 실용적 가치를 동시에 제공하며, 향후 연구자들이 더욱 강건하고 해석 가능한 이상탐지 시스템을 개발하는 데 중요한 기반을 마련했습니다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/c5156606-c9b7-4563-8ba2-9d82051420b5/KDD21_InterFusion_Li.pdf)
