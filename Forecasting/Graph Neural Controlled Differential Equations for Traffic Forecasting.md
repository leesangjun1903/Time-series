# Graph Neural Controlled Differential Equations for Traffic Forecasting

### 1. 핵심 주장 및 주요 기여 요약[1]

이 논문은 **STG-NCDE (Spatio-Temporal Graph Neural Controlled Differential Equations)**라는 새로운 모델을 제안하여 교통 흐름 예측 문제를 해결합니다. 핵심 주장은 Neural Controlled Differential Equations (NCDEs)의 개념을 그래프 신경망과 결합하면, 시공간적 교통 데이터의 복잡한 의존성을 더욱 효과적으로 포착할 수 있다는 것입니다.[1]

**주요 기여**는 다음과 같습니다.[1]

첫째, 시간적 의존성과 공간적 의존성을 각각 처리하는 두 개의 NCDE를 설계하고 이를 단일 프레임워크로 통합했습니다. 둘째, NCDEs는 불규칙한 시계열 데이터에 대해 본질적으로 강건하므로, 제안된 방법은 센서 오류나 결측 데이터가 있는 실제 환경에 적용 가능합니다. 셋째, 6개의 벤치마크 데이터셋과 20개의 기존 방법과의 비교 실험에서 모든 경우에 최고의 정확도를 달성했습니다.

***

### 2. 해결 문제, 제안 방법, 모델 구조 상세 설명

#### 해결하는 문제[1]

시공간 교통 데이터는 다음과 같이 정의됩니다:[1]

$$
\{G_{t_i} = (V, E, F_i, t_i)\}_{i=0}^{N}
$$

여기서 $$V$$는 노드(도로 지점) 집합, $$E$$는 에지(도로 연결) 집합, $$F_i \in \mathbb{R}^{|V| \times D}$$는 시간 $$t_i$$의 노드 특성 행렬, $$D$$는 특성 차원입니다. 목표는 과거 $$N+1$$개의 시간 단계를 기반으로 향후 $$S$$개 시간 단계의 교통량 $$\hat{Y} \in \mathbb{R}^{|V| \times S \times M}$$을 예측하는 것입니다. [1]

기존 방법들(DCRNN, STGCN, GraphWaveNet 등)은 그래프 합성곱 신경망(GCN)과 순환 신경망(RNN)을 결합하지만, 이들의 조합이 최적인지 명확하지 않습니다. 제안 논문은 더 효과적인 이론적 틀인 제어 미분방정식(CDE)을 도입합니다.[1]

#### 제안 방법: Neural Controlled Differential Equations (NCDEs)[1]

기존 RNN은 다음과 같이 근사됩니다:[1]

$$
z(T) = z(0) + \int_0^T f(z(t); \theta_f) \frac{dX(t)}{dt} dt
$$

여기서 $$z(t)$$는 숨겨진 상태 궤적, $$X(t)$$는 연속 경로, $$f$$는 학습 가능한 함수입니다. 이는 일반적인 Riemann-Stieltjes 적분 문제입니다.

전처리 단계에서 각 노드 $$v$$의 이산 시계열 $$\{F_i^{(v)}\}_{i=0}^{N}$$에 대해 자연 큐빅 스플라인 보간을 사용하여 연속 경로 $$X^{(v)}(t)$$를 생성합니다.[1]

#### 모델 구조[1]

**시간 처리 (Temporal Processing)**:[1]

$$
H(T) = H(0) + \int_0^T f(H(t); \theta_f) \frac{dX(t)}{dt} dt
$$

여기서 $$H(t) \in \mathbb{R}^{|V| \times \dim(h^{(v)})}$$는 시간 정보의 숨겨진 궤적이고, CDE 함수 $$f$$는 각 행을 독립적으로 처리합니다. [1]

$$
f(H(t); \theta_f) = \psi(FC_{|V| \times \dim(h^{(v)}) \to |V| \times \dim(h^{(v)})}(A_K))
$$

여기서 $$A_K$$는 $$K$$개의 완전 연결 계층을 거친 결과이고, $$\sigma$$는 ReLU, $$\psi$$는 쌍곡탄젠트 활성화 함수입니다.[1]

**공간 처리 (Spatial Processing)**:[1]

$$
Z(T) = Z(0) + \int_0^T g(Z(t); \theta_g) \frac{dH(t)}{dt} dt
$$

여기서 $$Z(t)$$는 공간 처리 후 숨겨진 궤적이고, CDE 함수 $$g$$는 다음과 같이 정의됩니다:[1]

$$
g(Z(t); \theta_g) = \psi(FC_{|V| \times \dim(z^{(v)}) \to |V| \times \dim(z^{(v)})}(B_1))
$$

$$
B_1 = (I + \phi(\sigma(E \cdot E^\top)))B_0W_{spatial}
$$

여기서 $$E \in \mathbb{R}^{|V| \times C}$$는 학습 가능한 노드 임베딩 행렬, $$\phi$$는 소프트맥스 활성화, $$I$$는 항등행렬, $$W_{spatial}$$은 학습 가능한 가중치 변환 행렬입니다. 이 구조는 1차 Chebyshev 다항식 그래프 합성곱 연산과 동일합니다. [1]

**결합된 프레임워크**:[1]

두 NCDE를 결합하면:

$$
Z(T) = Z(0) + \int_0^T g(Z(t); \theta_g)f(H(t); \theta_f) \frac{dX(t)}{dt} dt
$$

실제 구현을 위해 다음의 확대 ODE를 정의합니다:[1]

$$
\frac{d}{dt}\begin{bmatrix} Z(t) \\ H(t) \end{bmatrix} = \begin{bmatrix} g(Z(t); \theta_g)f(H(t); \theta_f) \frac{dX(t)}{dt} \\ f(H(t); \theta_f) \frac{dX(t)}{dt} \end{bmatrix}
$$

**출력층과 손실함수**:[1]

최종 예측은:

$$
\hat{y}^{(v)} = z^{(v)}(T)W_{output} + b_{output}
$$

학습 목표는 L1 손실을 사용합니다:[1]

$$
L = \frac{\sum_{\tau \in T} \sum_{v \in V} \|y_{(\tau,v)} - \hat{y}_{(\tau,v)}\|_1}{|V| \times |T|}
$$

***

### 3. 모델의 일반화 성능 향상 관련 내용[1]

#### 일반화 성능 분석

**다중 데이터셋에서의 일관된 성능**:[1]

STG-NCDE는 6개의 벤치마크 데이터셋(PeMSD3, PeMSD4, PeMSD7, PeMSD8, PeMSD7(M), PeMSD7(L))에서 모두 최고 성능을 달성했습니다. 특히 Table 2에서 평균적으로:

- MAE: 12.72 (상대 성능 100%)
- RMSE: 21.33 (상대 성능 100%)
- MAPE: 10.10% (상대 성능 100%)

두 번째 최고 성능의 Z-GCNETs와 비교하면 STG-NCDE는 더욱 안정적입니다.[1]

**예측 지평에서의 성능**:[1]

Figure 5는 각 예측 시간 단계에서의 오류를 보여줍니다. STG-NCDE는 모든 예측 지평(1~12단계)에서 AGCRN, Z-GCNETs, STGODE보다 일관되게 낮은 오류를 유지합니다. 이는 단기 예측뿐 아니라 장기 예측에서도 우수한 일반화 능력을 보여줍니다.[1]

**불규칙 시계열에 대한 강건성**:[1]

논문은 실제 환경의 결측 데이터를 반영하기 위해 불규칙 교통 예측 실험을 수행했습니다. 10%~50%의 데이터 결측 상황에서:[1]

Table 5 (PeMSD4)의 예:
- 10% 결측: MAE 19.36 (정상 데이터: 19.21)
- 30% 결측: MAE 19.40
- 50% 결측: MAE 19.98

성능 저하가 미미하며, 이는 NCDEs의 불규칙 시계열 처리 능력이 뛰어남을 의미합니다. 반면 시간 처리만 하는 "Only Temporal" 모델은 같은 조건에서 MAE가 26~60대로 급증합니다.[1]

#### 일반화 향상의 원인 분석

**1. 이론적 타당성**:[1]

모델의 Lipschitz 연속성을 증명함으로써 well-posedness를 보장합니다. ReLU, Tanh, Sigmoid 등 대부분의 활성화 함수는 Lipschitz 상수가 1이고, 이는 안정적인 학습을 보장합니다.[1]

**2. 공간-시간 상호작용의 효과적 모델링**:[1]

Ablation 연구 (Table 3, 4)에서:
- Only Temporal: PeMSD3에서 RMSE 32.82
- Only Spatial: PeMSD3에서 RMSE 27.17
- STG-NCDE: PeMSD3에서 RMSE 27.09

시간과 공간 처리를 모두 사용할 때 최고 성능을 달성합니다. 특히 공간 처리의 적응형 인접 행렬 $$\phi(\sigma(E \cdot E^\top))$$은 데이터 기반 그래프 토폴로지를 학습하므로 사전 정의된 그래프보다 유연합니다.[1]

**3. 초기값 생성의 중요성**:[1]

- $$H(0) = FC_{D \to \dim(h^{(v)})}(F_{t_0})$$
- $$Z(0) = FC_{\dim(h^{(v)}) \to \dim(z^{(v)})}(H(0))$$

이러한 계층적 초기값 생성은 정보 흐름을 효과적으로 시작합니다.[1]

**4. 하이퍼파라미터 민감도**:[1]

Figure 4 (b)는 노드 임베딩 차원 $$C$$에 대한 민감도를 보여줍니다. $$C = 7$$ 이후 성능이 안정화되며, $$C = 10$$에서 최적입니다. 이러한 조정으로 모든 데이터셋에서 일관된 성능을 달성합니다.[1]

---

### 4. 성능 향상 및 한계 분석

#### 성능 향상[1]

**벤치마크 비교 (Table 2)**:[1]

상위 기존 방법들과의 상대 성능:
- Z-GCNETs: MAE 기준 104.0% (4% 더 나쁨)
- AGCRN: 104.7% (4.7% 더 나쁨)
- STGODE: 106.6% (6.6% 더 나쁨)

**구체적 예시 (Figure 3)**:[1]

PeMSD4의 Node 111과 PeMSD8의 Node 9에서 STG-NCDE는 Z-GCNETs이 실패하는 급격한 교통량 변화(highlighted boxes)를 정확하게 포착합니다. Z-GCNETs는 평탄한 직선으로 예측하지만, STG-NCDE는 실제 급변을 추적합니다.[1]

#### 한계[1]

**1. 계산 복잡도**:[1]

ODE 솔버(DOPRI, RK4 등)를 사용하는 NCDEs는 미분방정식을 수치적으로 풀어야 하므로, RNN 기반 방법보다 계산량이 많습니다. 논문에서는 이에 대한 명시적인 시간 비교를 제공하지 않습니다.[1]

**2. 작은 네트워크에서의 성능**:[1]

PeMSD7(M) (228 노드)과 같은 상대적으로 작은 네트워크에서는 STG-NCDE의 장점이 더 제한적입니다.[1]

**3. 불규칙 데이터의 극단적 상황**:[1]

50% 결측 데이터에서 MAE가 약 4~5% 증가하는데, 더 극심한 불규칙성(70% 이상)에서의 성능은 평가되지 않았습니다.[1]

**4. 적응형 그래프 토폴로지의 해석성**:[1]

학습된 인접 행렬 $$\phi(\sigma(E \cdot E^\top))$$이 도로 네트워크의 실제 지리적 연결성을 얼마나 잘 반영하는지 분석되지 않았습니다.[1]

***

### 5. 연구 영향 및 향후 고려사항

#### 앞으로의 연구에 미치는 영향[1]

**1. NCDE 확장의 새로운 방향**:[1]

이 논문은 NCDEs를 처음으로 그래프 신경망과 결합했습니다. 향후 연구는:
- 기후 예측, 센서 네트워크, 소셜 네트워크 등 다른 시공간 작업으로 확장
- 여러 스케일의 NCDE 계층 추가
- 그래프 동적성 (동적 엣지/노드)을 고려한 개선

**2. 불규칙 시계열 처리의 중요성 강조**:[1]

논문은 Tables 5, 6에서 불규칙 교통 예측을 처음으로 보여줍니다. 이는:
- 결측 데이터 문제를 해결하는 실용적 응용
- 센서 오류 환경에서의 견강한 모델 필요성 인식
- 데이터 전처리 비용 감소 가능성

**3. 이론과 실무의 연결**:[1]

Lipschitz 연속성 증명(well-posedness)은 다른 미분방정식 기반 모델의 안정성 분석에 참고 자료가 됩니다.[1]

#### 향후 연구 시 고려할 점[1]

**1. 계산 효율성 개선**:[1]

- Fast ODE solver 개발
- 근사 방법 (exact ODE 대신 근사 미분방정식) 탐색
- GPU 최적화 및 병렬화

**2. 일반화 경계 분석**:[1]

- 다양한 크기의 그래프 (수십~수십만 노드)에서의 성능
- 서로 다른 도메인(교통, 기후, 센서 네트워크) 간 전이 학습 가능성

**3. 적응형 그래프 학습의 검증**:[1]

- 학습된 그래프 토폴로지와 실제 도로 네트워크의 일치도 분석
- 그래프 구조 변화가 예측에 미치는 영향 평가

**4. 실세계 배포 고려**:[1]

- 온라인 학습 능력 (시간에 따른 배포 변화 적응)
- 프라이버시 보존 학습 (분산된 센서 데이터)
- 실시간 예측 가능성 검증 (지연 시간 제약)

**5. 다중 작업 학습**:[1]

- 교통량과 속도를 동시에 예측하는 다중 작업 설정
- 서로 다른 도로 유형(고속도로, 일반도로)에 대한 조건부 예측

**6. 불확실성 정량화**:[1]

- 예측 신뢰도 추정 (신뢰 구간 제공)
- Bayesian NCDEs 또는 확률적 변형 탐색

***

## 요약

STG-NCDE는 **Neural Controlled Differential Equations를 처음으로 그래프 신경망과 결합**하여 시공간 교통 예측 문제를 혁신적으로 해결합니다. 논문의 강점은 이론적 타당성(well-posedness), 불규칙 시계열에 대한 자연스러운 강건성, 그리고 6개 데이터셋 모두에서의 일관된 최고 성능입니다. 다만 계산 복잡도, 작은 네트워크에서의 제한된 이점, 그리고 적응형 그래프 학습의 해석성이 향후 개선 과제입니다. 이 연구는 시공간 신경망 아키텍처 설계에 새로운 패러다임을 제시하며, 불규칙 데이터 처리와 안정적인 학습이 중요한 모든 응용 분야로 확산될 잠재력을 가집니다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/328e86df-f000-4e08-876a-00daacbf38e2/2112.03558v1.pdf)
