# Adaptive Conformal Predictions for Time Series

### 1. 핵심 주장 및 주요 기여 요약

**"Adaptive Conformal Predictions for Time Series"** 논문의 핵심 주장은 **Adaptive Conformal Inference (ACI)가 시계열 데이터와 같은 일반적인 종속성을 가진 데이터에도 효과적으로 적용될 수 있다**는 것입니다. 이 논문이 제시하는 주요 기여는 다음과 같습니다:[1]

**주요 기여:**

1. **이론적 분석**: ACI의 학습률(γ) 매개변수가 교환가능한(exchangeable) 경우와 자기회귀(AR) 경우에 미치는 영향을 이론적으로 분석했습니다. 특히 γ=0인 경우 대비 γ > 0일 때의 효율성 변화를 마르코프 연쇄 이론을 통해 증명했습니다.[1]

2. **매개변수-자유 알고리즘 제안**: **AgACI(Online Expert Aggregation on ACI)**라 불리는 매개변수-자유 방법을 제안했습니다. 이는 온라인 전문가 집계(online expert aggregation)를 기반으로 여러 γ 값을 자동으로 조합하여 최적의 예측 구간을 생성합니다.[1]

3. **광범위한 실험 평가**: 합성 데이터와 실제 프랑스 전력가격 데이터를 통해 ACI와 경쟁 방법들(EnbPI, 온라인 SCP)의 성능을 공정하게 비교했습니다.

***

### 2. 문제 정의, 제안 방법, 모델 구조 및 성능

#### 2.1 해결하고자 하는 문제

**배경**: 기존의 Conformal Prediction (CP)은 **데이터의 교환가능성 가정**에 의존하지만, 시계열 데이터는 이 가정을 만족하지 않습니다. 또한 강한 분포 이동(distribution shift)이 없는 일반적인 시계열 데이터에서도 유효한 예측 구간을 생성해야 합니다.[1]

**주요 문제**:
- 시계열 데이터의 시간적 종속성으로 인한 구간 예측의 유효성 문제
- 예측 구간의 두 가지 목표 간 균형: **타당성(validity)** (목표 적중률 달성)과 **효율성(efficiency)** (구간의 짧기)

#### 2.2 제안하는 방법

**핵심 아이디어**: ACI는 재귀적으로 miscoverage 수준 α_t를 업데이트합니다.[1]

기본 ACI 공식:

$$
\widehat{C}_{\alpha_t}(x_t) = [\hat{\mu}(x_t) \pm \widehat{Q}_{1-\alpha_t}(S_{Cal_t})]
$$

$$
\alpha_{t+1} = \alpha_t + \gamma \left(\alpha - \mathbb{1}\{y_t \notin \widehat{C}_{\alpha_t}(x_t)\}\right)
$$

여기서:[1]
- $α_t$ : t 시점의 적응된 miscoverage 수준
- $γ$ : 학습률 (0 ≤ γ)
- $𝟙{·}$: 지시 함수
- $Q̂_{1-α_t}(S_{Cal_t})$ : calibration set의 (1-α_t)-분위수

**AgACI 알고리즘**: 여러 γ 값으로 ACI를 병렬 실행하고, 온라인 전문가 집계(Algorithm 1)로 결합합니다.[1]

```
Algorithm 1: Online Expert Aggregation on ACI (AgACI)

입력: 미적중률 α, 그리드 {γ_k, k ∈ [1,K]}, 집계 규칙 Φ

각 시점 t에서:
1. K개 각 γ_k에 대해 ACI 실행 → 구간 C̃_t,k(x_t) = [b̂^(ℓ)_t,k(x_t), b̂^(u)_t,k(x_t)]
2. Pinball 손실 기반 가중치 계산:
   ω^(ℓ)_t,k, ω^(u)_t,k = Φ({ρ_β(y_s, b̂^(·)_s,l(x_s)), s ∈ [T_0+1, t]})
3. 가중 평균으로 최종 구간 생성:
   C̃_t(x) = [∑_k ω^(ℓ)_t,k b̂^(ℓ)_t,k(x) / ∑_l ω^(ℓ)_t,l, ∑_k ω^(u)_t,k b̂^(u)_t,k(x) / ∑_l ω^(u)_t,l]
```

여기서 Φ는 Bernstein Online Aggregation (BOA)를 사용합니다.[1]

#### 2.3 이론적 결과

**Theorem 3.1 (교환가능한 경우)**:[1]
점수가 교환가능하면, γ > 0에 대해 평균 구간 길이는:

$$
E_{\pi_\gamma}[L] = L_0 + Q''(1-\alpha) \cdot \frac{\gamma}{2}\alpha(1-\alpha) + O(\gamma^{3/2})
$$

여기서 Q''(1-α) > 0이므로 **ACI는 교환가능한 데이터에서 효율성을 감소시킵니다**.

**Theorem 3.2 (AR(1) 경우)**:[1]
잔차가 AR(1) 과정 $ε_{t+1} = φε_t + ξ_{t+1}$를 따르면, 최적 학습률 $γ*_φ$ 가 존재하며:
- φ가 작으면 γ=0이 최적
- φ가 중간 크기면 γ > 0이 효율성 향상
- φ가 매우 크면 안정성을 위해 더 작은 γ가 필요

이는 시계열의 종속 강도에 따라 γ를 조정해야 함을 의미합니다.[1]

#### 2.4 모델 구조 및 알고리즘 설계

**설계 특징**:

1. **온라인 절차**: 모든 점에서 최근 T_0개의 데이터로부터 training/calibration 분할을 재수행
2. **순차적 분할**: 미래 관측을 배제하기 위해 시간 인덱스로 training과 calibration 분리
3. **무한 구간 처리**: α_t가 음수가 되면 무한 구간(ℝ) 생성[1]

#### 2.5 성능 향상

**합성 실험 결과** (ARMA(1,1) 노이즈, T_0=200, T_1=100):[1]

| 데이터 특성 | 방법 | 적중률 | 중위 길이 | 특징 |
|----------|------|-------|---------|------|
| ϕ=θ=0.1 | OSSCP | 89.8% | 10.2 | 작은 종속성에서 유효 |
| | AgACI | 90.0% | 10.1 | 안정적 |
| ϕ=θ=0.99 | OSSCP | 87.2% | 9.8 | 높은 종속성에서 붕괴 |
| | ACI (γ=0.01) | 90.1% | 9.3 | 유효하고 효율적 |
| | AgACI | 90.2% | 9.5 | 무한 구간 증가 |

**프랑스 전력가격 예측** (2019년 일별 예측):[1]
- AgACI: 적중률 91.2%, 중위 길이 22.5
- ACI (γ=0.01): 적중률 91.5%, 중위 길이 21.2
- EnbPI V2: 적중률 92.8%, 중위 길이 24.3

#### 2.6 주요 한계

1. **무한 구간 문제**: γ가 크면 α_t < 0이 자주 발생하여 전체 실수선을 예측합니다. 이는 정보를 전혀 제공하지 않습니다.[1]

2. **γ 선택의 어려움**: 최적 γ는 데이터 특성에 크게 의존하며, 실무에서 미리 알기 어렵습니다.[1]

3. **AgACI의 이론적 보장 부족**: 제안된 집계 알고리즘의 타당성과 효율성에 대한 이론적 분석이 미흡합니다.[1]

4. **계산 비용**: K개의 다른 γ에 대해 병렬 실행해야 하므로 K배의 추가 비용이 발생합니다.

5. **bootstrap의 시계열 부적응성**: EnbPI의 비교에서 고전적 bootstrap이 사용되어 시계열 특성을 충분히 반영하지 못합니다.[1]

---

### 3. 모델의 일반화 성능 향상 가능성

이 논문이 **일반화 성능 향상에 미치는 영향**은 다층적입니다:

#### 3.1 이론적 보장의 강화

**기존 한계**: 표준 SCP는 교환가능성 가정을 만족하지 않는 시계열에서 타당성 보장이 없습니다.[1]

**본 논문의 기여**:
- ACI의 점근적 타당성은 **임의의 데이터 분포에 적용** (Theorem 3.1)
- 이는 비정상(non-stationary) 시계열에서도 유효성 확보 가능

#### 3.2 적응성을 통한 효율성 개선

**핵심 발견**:

Figure 2의 분석에서 보면, AR(1) 과정에서:[1]
- ϕ = 0 (독립): γ* ≈ 0 (ACI 미사용)
- ϕ = 0.85: γ* ≈ 0.025 (중간 정도)
- ϕ = 0.99: γ* ≈ 0.015 (작은 값, 안정성 중시)

이는 **시계열의 메모리 길이에 따라 적응적으로 학습률을 조정하면 구간 길이를 5-20% 단축**할 수 있음을 의미합니다.[1]

#### 3.3 AgACI를 통한 매개변수-자유 일반화

AgACI는 사용자가 γ를 선택할 필요 없이:[1]

- **타당성 보장**: 모든 시뮬레이션에서 89.8% 이상 적중률 달성
- **효율성 경쟁력**: 개별 γ 값들의 성능에 가깝게 유지
- **적응성**: 데이터 특성 변화에 자동 대응

#### 3.4 다양한 시계열 구조에 대한 강건성

실험 결과:[1]
- **ARMA(1,1)**: 다양한 (ϕ, θ) 조합에서 일관되게 유효
- **AR(1)**: 높은 자기상관(ϕ=0.99)에서도 타당성 유지
- **MA(1)**: 약한 구조에서 이미 SCP 유효

이는 시계열 구조가 복잡할수록 ACI의 장점이 더욱 두드러짐을 보여줍니다.

#### 3.5 실제 응용에서의 일반화

프랑스 전력가격 사례:[1]
- 데이터에 극값과 비정상성 포함
- AgACI: **적중률 91.2%로 안정적**이고 짧은 구간 제공
- 이는 미리 학습된 특정 γ 없이도 현실 데이터 적응 가능

***

### 4. 향후 연구에 미치는 영향과 고려사항

#### 4.1 이론적 확장 방향

1. **AgACI의 이론적 분석 필요**
   - 온라인 전문가 집계의 점근적 타당성 증명
   - 효율성 보장 조건 도출
   - 이는 다른 시계열 불확실성 정량화 방법 발전에 기여할 것[1]

2. **비정상 시계열 이론**
   - Theorem 3.1, 3.2의 결과를 구간 변화 또는 트렌드가 있는 경우로 확장
   - 에르고딕 이론(ergodic theory)을 초과 기대와 시간-변화 종속성에 적용

#### 4.2 알고리즘 개선

1. **적응적 γ 선택**
   - 데이터의 자기상관 함수(ACF)로부터 γ 범위 자동 제안
   - 온라인으로 ACF를 추정하여 γ 범위 동적 조정

2. **무한 구간 완화**
   - α_t의 클리핑(clipping) 전략 개발
   - 구간 길이 정규화(regularization)

#### 4.3 응용 영역 확대

논문이 제시하는 방법은 다음 영역에서 중요:[1]

| 응용 분야 | 도움이 되는 이유 | 예상 효과 |
|---------|-----------------|---------|
| 에너지 시장 | 전력가격/수요 예측의 위험 정량화 필수 | 더 정확한 리스크 관리 |
| 금융 예측 | 시계열 종속성 강함, 이상치 빈번 | 강건한 신뢰 구간 |
| 기후/날씨 | 높은 자기상관 구조 | 주간/월간 예측 신뢰도 향상 |
| 의료 감시 | 환자 모니터링의 실시간 구간 필요 | 임계값 기반 알림의 신뢰성 |

#### 4.4 방법론적 발전

1. **다변량 확장**: 현재는 단변량 시계열 중심 → 다변량 예측 구간으로 확대 필요

2. **다양한 CP 절차와의 결합**: 
   - 위/아래 분위수를 따로 모델링하는 구간(quantile-based intervals)과 결합
   - Local conformal prediction과의 조합

3. **신경망 통합**: 
   - RNN/LSTM 같은 순환 신경망의 예측 불확실성 정량화
   - Transformer 기반 시계열 모델과의 호환성

#### 4.5 실무 고려사항

논문이 제기하는 구현 과제:[1]

1. **계산 효율성**
   - K개 전문가 실행의 병렬화
   - 온라인 집계의 메모리 최적화

2. **hyperparameter 설정**
   - γ 그리드 선택 가이드라인 부재
   - 집계 규칙(EWA, ML-Poly, FTRL 등) 선택 기준 모호

3. **코드/재현성**
   - 논문은 Python 구현과 데이터를 공개했으나, 다양한 시계열 라이브러리(statsmodels, Prophet 등)와의 통합 필요[1]

#### 4.6 연구 커뮤니티 기여

- **Conformal prediction 분야 성숙화**: 시계열 특화 방법론의 이론적 토대 제공
- **온라인 학습과의 교점**: 시간-변화 환경에서의 예측 불확실성 정량화 일반화
- **재현성**: GitHub의 완전한 코드와 데이터 공개로 후속 연구 촉진[1]

***

### 결론

"Adaptive Conformal Predictions for Time Series"는 **시계열 데이터에서 분포-자유(distribution-free) 예측 구간을 생성하는 문제에 대한 이론과 실용 해법을 제시**합니다. 핵심은:

1. **이론적**: ACI의 γ 매개변수가 종속성 강도에 따라 효율성에 미치는 영향을 정량화
2. **실용적**: 매개변수 선택 문제를 온라인 전문가 집계로 해결
3. **검증**: 합성/실제 데이터 모두에서 기존 방법을 능가

향후 이 방향의 연구는 **불확실성 정량화가 중요한 모든 시계열 응용에서 의사결정을 더 강건하게** 만들 것으로 예상됩니다.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/00b8cc56-1b7a-440d-a857-7ed4bb6b9425/2202.07282v1.pdf)
