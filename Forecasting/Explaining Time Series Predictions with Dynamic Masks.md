# Explaining Time Series Predictions with Dynamic Masks

## 1. 핵심 주장과 주요 기여

**Dynamask**는 다변량 시계열 데이터에 대한 기계학습 모델의 예측을 설명하기 위한 혁신적인 **동적 마스크(Dynamic Mask) 기반 설명가능성 방법**이다. 본 논문의 핵심 주장은 기존 설명가능인공지능(XAI) 방법들이 시계열 데이터의 시간적 의존성과 입력 변수의 대규모성을 제대로 처리하지 못한다는 것이다.[1]

**세 가지 주요 기여:**

첫째, **시간 맥락 통합**: 동적 섭동 연산자(dynamic perturbation operator)를 도입하여 인접한 시간 단계의 특성값을 활용한 의미 있는 섭동을 생성함으로써 시간 의존성을 자연스럽게 반영한다.[1]

둘째, **절약성(Parsimony) 달성**: 극단적 마스크(extremal mask) 개념을 통해 예측을 재현하기 위해 필요한 최소한의 입력만 선택하도록 강제하며, 이는 정보 이론과 연결되어 있다.[1]

셋째, **가독성 개선**: 마스크 엔트로피(mask entropy)와 마스크 정보(mask information)라는 두 가지 정량적 지표를 도입하여 설명의 명확성을 측정하고 비교 가능하게 만든다.[1]

## 2. 문제 정의, 제안 방법, 모델 구조

### 2.1 해결하고자 하는 문제

기존 설명가능성 방법들은 다음 세 가지 과제를 해결하지 못한다:[1]

1. **시간 의존성 무시**: 모델-무관(model-agnostic) 방법들은 모든 시간 단계를 독립적인 특성으로 취급하여 시간적 맥락을 소실한다. 예를 들어, 주식 가격 예측에서 매수/매도 결정은 연속적인 3개 시간 단계의 맥락이 필요하지만, 기존 방법은 각 시간 단계를 독립적으로 분석한다.[1]

2. **대규모 입력 문제**: 특성 개수 × 시간 단계 수로 인해 입력 차원이 폭증하여 설명 결과가 과도하게 복잡해진다.[1]

3. **주의 메커니즘의 한계**: 어텐션 기반 방법에서 주의 가중치와 특성 중요도 간의 상관관계가 명확하지 않다.[1]

### 2.2 제안 방법: 수식 기반 설명

**정의 2.1 마스크**: 입력 시계열 $$X \in \mathbb{R}^{T \times d_X}$$와 블랙박스 $$f$$에 대해, 마스크는 $$M \in ^{T \times d_X}$$로 정의되며, 각 요소 $$m_{t,i}$$는 시간 $$t$$에서 특성 $$i$$의 중요도를 나타낸다.[1]

**정의 2.2 섭동 연산자**: 마스크 $$M$$에 연관된 선형 연산자 $$\Psi_M: \mathbb{R}^{T \times d_X} \to \mathbb{R}^{T \times d_X}$$는 다음을 만족한다:[1]

$$\Psi(X, m_{t,i}) = \alpha_{t,i} \text{(where } \frac{\partial \alpha_{t,i}}{\partial m_{t,i}} \text{ is differentiable)}$$

그리고 동적 섭동은 다음 조건을 만족한다:[1]

$$\Psi(X, m_{t,i})|_{t: t-W_1 \leq t' \leq t+W_2} = \alpha_{t,i}$$

여기서 $$W_1, W_2$$는 이전/이후 시간 단계 의존성을 제어하는 매개변수이다.

**세 가지 동적 섭동 연산자 예시**:[1]

1. **가우시안 블러**: $$\Psi_g(X, m_{t,i}) = \sum_{t'=1}^T x_{t',i} \cdot g(m_{t,i}|_{t-t'})$$ (복잡도: $$O(d_X T^2)$$)

2. **이동평균 페이드**: $$\Psi_m(X, m_{t,i}) = m_{t,i} \cdot x_{t,i} + (1-m_{t,i}) \cdot \frac{1}{2W+1}\sum_{t'=t-W}^{t+W} x_{t',i}$$ (복잡도: $$O(d_X T W)$$)

3. **과거만 사용 페이드**: $$\Psi_p(X, m_{t,i}) = m_{t,i} \cdot x_{t,i} + (1-m_{t,i}) \cdot \frac{1}{W}\sum_{t'=t-W}^t x_{t',i}$$ (예측에 유용)

**마스크 최적화 목적함수**:[1]

```math
\min_{M \in ^{T \times d_X}} \underbrace{L_e(M)}_{\text{오차항}} + \lambda_a \underbrace{L_a(M)}_{\text{절약성}} + \lambda_c \underbrace{L_c(M)}_{\text{시간연속성}}
```

[1]

여기서:

- **오차항**: 회귀는 $$L_e(M) = \sum_{t=t_y}^T \sum_{i=1}^{d_Y} (f(\Psi_M(X))\_{t,i} - f(X)_{t,i})^2$$

- **절약성 정규화**: $$L_a(M) = \|\text{vecsort}(M) - r_a\|_2^2$$ (여기서 $$r_a$$는 상위 $$a \cdot d_X T$$개만 1로 설정)

- **시간연속성 페널티**: $$L_c(M) = \sum_{i=1}^{d_X} \sum_{t=1}^{T-1} |m_{t+1,i} - m_{t,i}|$$

**극단적 마스크**: 특정 정확도 임계값 $$\epsilon$$ 하에서 최소 입력 분율을 찾는 문제:

```math
\min_{a \in } L_e(M^*_a) \text{ subject to } L_e(M^*_a) \leq \epsilon
```
[1]

### 2.3 정보 이론 기반 평가 지표

**정의 2.3 마스크 정보**: 입력 부분수열 $$A \subseteq \{1 \ldots T\} \times \{1 \ldots d_X\}$$에 대해:[1]

$$I_M^A = -\sum_{(t,i) \in A} \ln(1 - m_{t,i})$$

직관: $$m_{t,i} \to 1$$일 때 정보가 증가한다 (Shannon 정보와 반대).

**정의 2.4 마스크 엔트로피**:[1]

$$S_M^A = -\sum_{(t,i) \in A} [m_{t,i} \ln(m_{t,i}) + (1-m_{t,i})\ln(1-m_{t,i})]$$

**명제 2.1 메트릭 속성**: 두 측도 모두 다음을 만족한다:[1]

- **양성**: $$I_M^A \geq 0, S_M^A \geq 0$$
- **가산성**: $$I_M^{A \cup B} = I_M^A + I_M^B$$ (불교집합일 때)
- **단조성**: $$A \subseteq B \Rightarrow I_M^A \leq I_M^B$$

이는 $$I_M, S_M$$이 입력 인덱스 공간에서 측도를 정의함을 보장한다.

## 3. 모델 구조 및 최적화 알고리즘

**알고리즘 1: Dynamask**:[1]

입력: 시계열 $$X \in \mathbb{R}^{T \times d_X}$$, 블랙박스 $$f$$, 섭동 연산자 $$\Psi$$, 마스크 영역 $$a \in $$, 학습률 $$\eta$$, 모멘텀 $$\mu$$[1]

초기화: $$M^{(0)} = 0.5^{T \times d_X}$$, $$\lambda_a^{(0)} \approx 0.1$$

반복 (N번 에포크):
1. 섭동 입력 계산: $$\tilde{X} = \Psi_M(X)$$
2. 손실 계산 및 역전파
3. $$\lambda_a$$를 지수적으로 증가 ($$\times 1000$$까지)
4. $$M$$을 $$[0,1]$$로 클램프[1]

**두 가지 변형**:[1]

1. **보존형**: 특성을 보존할 때 오차 최소화 (원본)
2. **삭제형**: 특성을 최대로 섭동할 때 오차 최대화 (임상 데이터용)

## 4. 성능 향상 및 실험 결과

### 4.1 흰상자 회귀 (신드롬 특성 알려짐)

**실험 설정**: 50 시간 단계 × 50 특성, ARMA 과정으로 생성, 5개 특성과 5개 시간 단계 선택[1]

| 메트릭 | Dynamask | Feature Occlusion | Integrated Gradient |
|--------|----------|------------------|------------------|
| AUR | 0.68±0.04 | 0.14±0.04 | 0.14±0.04 |
| IMA | 1290±106 | 49±14 | 38±12 |
| SMA | 7.1±2.5 | 48.3±6.5 | 48.7±6.7 |

**결론**: Dynamask는 true salient 특성의 **82%를 고르게 식별**하면서 매우 낮은 엔트로피(7.1 vs 48.3)를 유지한다.[1]

### 4.2 은상자 분류 (숨겨진 마르코프 모델)

**실험**: 200 시간 단계, 3개 특성, GRU 200셀 RNN, 각 시간에 정확히 1개 특성이 중요[1]

| 메트릭 | Dynamask | Integrated Gradient | RETAIN |
|--------|----------|------------------|--------|
| AUROC | 0.93±0.00 | 0.91±0.00 | 0.42±0.03 |
| AUPRC | 0.85±0.00 | 0.79±0.00 | 0.51±0.01 |
| 식별된 특성 수 | 32 | 87 | - |

**핵심 발견**: IG는 87개 입력을 중요하다고 표시한 반면, Dynamask는 32개로 제한 (실제로 13개만 중요). 따라서 **파싱모니(절약성)에서 명확히 우수**하다.[1]

### 4.3 임상 데이터 (MIMIC-III 사망률 예측)

**실험**: 40,000 ICU 환자, 48시간, 31개 의료 특성, 환자별 마스크 적합[1]

**방법**: 중요 특성을 시간 평균값으로 대체 후 예측 변화 측정

![MIMIC 결과][1]

**결과**:
- **교차엔트로피 (높을수록 좋음)**: Dynamask는 모든 $$a$$에서 최고 (0.07-0.08)
- **정확도 (낮을수록 좋음)**: Dynamask는 0.984-0.996 유지 (가장 안정적)
- **런타임**: 환자당 평균 3.58초

**해석**: 뒷부분 시간 단계의 입력에 집중 (RNN 단기 메모리 특성 반영)[1]

## 5. 일반화 성능 향상 가능성

### 5.1 크로스 데이터셋 적용성

Dynamask는 **모델 무관(model-agnostic) 부분 방법**으로 설계되어, 다음 상황에서 일반화가 강화된다:[1]

1. **신경망 독립성**: RNN, LSTM, GRU, Transformer 등 모든 시계열 모델에 적용 가능
2. **임시 구조 적응성**: 짧은 시계열(T=50)부터 긴 시계열(T=200)까지 성능 유지
3. **섭동 연산자 견고성**: 가우시안 블러, 이동평균, 과거평균 사이 높은 일치율 (0.80-0.85 AUROC)[1]

### 5.2 정보 이론 기반 불변성

마스크 엔트로피와 정보의 **세 가지 수학적 성질**(양성, 가산성, 단조성)이 보장되어:[1]

- 서로 다른 데이터셋에서 일관된 평가 가능
- 하이퍼파라미터 $$a$$ 변화에도 상대적 순위 유지
- 정규화된 버전 사용 시 절대값 비교 가능 ($$0 \leq i_M^A, s_M^A \leq 1$$)

### 5.3 극단적 마스크의 파레토 효율성

오류-절약성 트레이드오프에서:[1]

- **저 $$a$$**: 최소 입력만 선택 (높은 오류, 높은 해석가능성)
- **고 $$a$$**: 많은 입력 포함 (낮은 오류, 낮은 해석가능성)
- 실험에서 오류는 $$a \approx 0.05$$ 근처에서 평탄화되어 최적점 자동 결정 가능[1]

### 5.4 시간 의존성이 강한 도메인에서의 강화

Dynamask의 동적 섭동은 다음 특성이 강한 데이터에서 성능 향상:[1]

- **자기상관 구조**: ARMA 프로세스(실험에서 $$\rho_1=0.25, \rho_2=0.1, \rho_3=0.05$$)
- **상태 전이 의존성**: HMM 기반 데이터 (상태 천이 시 예측 변화)
- **시계열적 인과성**: 의료 데이터 (과거 상태가 현재 예측에 영향)

## 6. 제한사항 및 한계

### 6.1 계산 복잡성

**섭동 연산자의 복잡도**:[1]

| 연산자 | 시간복잡도 | 문제 |
|--------|-----------|------|
| 가우시안 $$\Psi_g$$ | $$O(d_X T^2)$$ | 긴 시계열에 부담 (T>100) |
| 이동평균 $$\Psi_m$$ | $$O(d_X T W)$$ | $$W$$ 선택에 민감 |

**런타임**: 극단적 마스크 찾기 평균 49.8초 (실험에서 T≤100)[1]

### 6.2 블랙박스 성능 의존성

**근본적 한계**: Dynamask는 기저 모델의 성능에 의존[1]

- 모델이 형편한 예측을 하면 설명도 형편함
- 예: 모델이 무작위로 예측하면 중요 특성 식별 불가능

### 6.3 정보 이론 해석의 한계

**마스크 엔트로피의 독립성 가정**:[1]

각 특성의 기여도를 **독립적으로 합산**하지만, 실제로는 특성 간 상관관계 존재:

$$S_M^A = -\sum_{(t,i) \in A} [...] \text{ (결합 분포 고려 안함)}$$

따라서 매우 강하게 상관된 특성들의 엔트로피는 과소평가될 수 있다.

### 6.4 동적 섭동의 선택 문제

**섭동 연산자의 임의성**: 세 가지 제안 연산자 중 "올바른" 선택이 불명확[1]

- 가우시안 vs 이동평균: 선택에 따라 0.80-0.85 AUROC 간 차이
- 사용자가 도메인 지식으로 선택해야 함

### 6.5 극단적 마스크 해석의 모호성

**오류 임계값 $$\epsilon$$ 설정**: 어떤 정확도까지 허용할지 명확하지 않음[1]

- 임상 데이터에서 0.9 $$\times$$ 전체 오류로 설정했지만, 도메인별로 달라질 수 있음

## 7. 연구에 미치는 영향 및 앞으로의 고려사항

### 7.1 학술적 기여

**XAI 분야 확대**: 본 논문은 **시계열 특화 설명가능성 방법**이 거의 없던 분야를 개척했다. 기존 XAI 연구는 이미지(CNN) 또는 표형(tabular) 데이터 중심이었으나, 이제 시계열에 대한 명확한 프레임워크를 제시한다.[1]

**정보 이론 연결**: 마스크 정보/엔트로피와 Shannon 이론의 연결이 새로운 **설명가능성 평가 체계**를 제안한다. 이는 다른 방법(FIT, RETAIN 등)과 정량적 비교를 가능하게 한다.[1]

### 7.2 산업 응용 가능성

**의료 분야**: Dynamask는 MIMIC-III 임상 데이터에서 입증되어, 병원 환경에서:[1]

- **의료진 신뢰**: "왜 환자 사망률이 높다고 예측했는가?"에 대한 명확한 시간-특성 기반 답변 제공
- **규제 준수**: GDPR, HIPAA 등 설명가능성 요구 충족

**금융 분야**: 주식/환율 시계열 예측에서:

- 특정 시간의 특정 경제 지표가 거래 결정에 미친 영향을 정량화
- 모델 감시 및 이상 탐지 용이

### 7.3 향후 연구 방향

**저자 제시 개선 사항**:[1]

1. **일관성 검증 강화**: 이미지 분류에서 사용되는 "Sanity Checks"와 같은 **더 정교한 일관성 테스트** 개발
   - 현재: 오류 기반만 평가
   - 제안: 반대사실(counterfactual) 검증, 인과성 테스트

2. **인과 해석 통합**: 단순 "상관성"을 넘어 **인과 관계** 파악
   - 예: 혈압 증가 → 사망률 상승 (인과 O) vs 두 특성 모두 같은 질환 신호 (인과 X)

### 7.4 다중 도메인 일반화를 위한 고려사항

**시계열 특성별 적응**:

| 도메인 | 시계열 특성 | 권장 섭동 연산자 | 주의사항 |
|--------|-----------|------------------|---------|
| 임상 데이터 | 자기상관 낮음, 노이즈 높음 | 이동평균 $$\Psi_m$$ | 이상치 처리 필수 |
| 금융 시계열 | 자기상관 높음, 트렌드 강함 | 가우시안 $$\Psi_g$$ | 계절성 제거 필요 |
| 센서 데이터 | 높은 빈도, 장기 의존성 | 과거 페이드 $$\Psi_p$$ | 실시간 처리 고려 |

**하이퍼파라미터 자동화**:

현재 $$\lambda_a, \lambda_c, W$$ 등을 수동 설정하지만, 향후:[1]

- **데이터 기반 초기화**: 자기상관 함수(ACF)로부터 $$W_1, W_2$$ 자동 결정
- **다중 섭동 앙상블**: 여러 연산자 결과를 결합하여 견고성 증진

### 7.5 확장 연구 주제

**1. 모델 독립적 경계 분석**

Dynamask의 오류 상한을 이론적으로 유도:[1]

$$L_e(M^*_a) \leq f(\text{모델 성능}, \text{시계열 복잡도}, a)$$

**2. 다중 시간 스케일 분석**

서로 다른 시간 단계에서의 특성 중요도를 계층적으로 표현:[1]

- 단기(minutes): 즉각 반응 특성
- 중기(hours): 누적 효과 특성  
- 장기(days): 추세 특성

**3. 강화학습과의 결합**

Dynamask를 RL 에이전트의 상태 특성 선택에 활용:

- 더 작은 상태 공간으로 학습 가속화
- 정책 설명가능성 향상

***

## 결론

**Dynamask**는 시계열 데이터의 예측 설명이라는 **오랜 미해결 과제**를 정보 이론과 동적 섭동의 창의적 조합으로 해결한 획기적 연구이다.[1]

**핵심 강점**: 
- 시간 의존성을 자연스럽게 통합하면서도 절약성과 가독성을 보장
- 정보 이론 기반 평가 지표로 다양한 방법 간 객관적 비교 가능
- 의료/금융 등 현실 도메인에서 즉시 적용 가능

**극복할 과제**: 
- 계산 복잡성 감소 (긴 시계열)
- 인과 추론 통합
- 하이퍼파라미터 자동화

향후 연구가 이러한 한계를 해결한다면, Dynamask는 **산업 규모의 XAI 솔루션**으로 자리매김할 것이다.[1]

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/65988149/761414f3-0640-465c-93f8-d4456e753998/2106.05303v1.pdf)
